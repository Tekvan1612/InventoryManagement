{% include 'product_tracking/head.html' %}
{% load static %}
{% block content %}


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>

    body, .form-container {
    background-color: #222222 !important; /* Dark background */
    color: #fff; /* Light text color */
}
input.form-control,
select.form-control {
    background-color: #222222 !important; /* White background */
    color: #fff !important; /* Black text */
    border: 1px solid #ced4da; /* Optional: add a subtle border */
}

input.form-control:focus,
select.form-control:focus {
    background-color: #fff; /* White background on focus */
    color: #222222; /* Black text */
    border-color: #80bdff; /* Optional: blue border on focus */
    outline: none; /* Remove default outline */
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25); /* Optional: focus shadow */
}

button.step-btn {
    background-color: #007bff; /* Blue button background */
    color: #fff; /* White text */
}

button.step-btn:hover {
    background-color: #0056b3; /* Darker blue on hover */
}

.dropdown-menu {
    background-color: #343a40; /* Dark background for dropdown */
    color: #fff; /* White text */
}

.dropdown-menu a {
    color: #fff !important; /* Ensure the dropdown text is white */
}

.dropdown-menu a:hover {
    background-color: #007bff; /* Highlight on hover */
    color: #fff;
}

/* Make sure the selects also follow the input styles */
select {
    background-color: #fff !important;
    color: #000 !important;
}
.crew-left-content {
    border: 2px solid grey;
    width: 30%;
    border-radius: 7px;
    margin-right: 43px;
    padding: 10px;

}
/* Accordion */
.left-equipment-container, .right-equipment-container {
    background-color: #2a2a3b; /* Darker background for equipment containers */
    border: 1px solid #3a3a4c; /* Subtle border */
    border-radius: 10px;
    padding: 15px;
}

.left-equipment-container .quantity-container, .right-equipment-container .equipment-table-container {
    background-color: #2a2a3b; /* Background inside the containers */
    padding: 10px;
}

.accordion-header {
    background-color: #3a3a4c; /* Darker accordion headers */
    color: #ffffff;
    padding: 10px;
    font-weight: bold;
}

.accordion-content {
    background-color: #222222 ; /* Dark background for accordion content */
    color: #ffffff;
    padding: 15px;
}

/* Table */
.table {
    background-color: #2a2a3b; /* Dark background for table */
    border: 1px solid #3b3b4f; /* Darker border */
    color: #ffffff;
}


.table tbody tr {
    border-bottom: 1px solid #4a4a5f; /* Subtle row separator */
}

.table tbody tr:hover {
    background-color: #343a40; /* Highlight row on hover */
}

.table td, .table th {
    padding: 10px; /* Spacing for table cells */
    color: #ffffff; /* White text */
}

.custom-table th, .custom-table td {
    padding-left: 20px; /* Padding inside table */
}

/* Dropdown Menu */
#equipmentDropdown {
    background-color: #2a2a3b; /* Darker dropdown menu */
    border: 1px solid #3b3b4f;
    color: #ffffff;
}

#equipmentDropdown .dropdown-item {
    color: #ffffff; /* White text */
    padding: 10px;
}

#equipmentDropdown .dropdown-item:hover {
    background-color: #3a3a4c; /* Slightly lighter background on hover */
}

/* Step Buttons */
.step-btn {
    background-color: #007bff; /* Primary button color */
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.step-btn:hover {
    background-color: #0056b3; /* Darker blue on hover */
}

.step-btn.active {
    background-color: #28a745; /* Green active button */
}

.crew-right-content {
    border: 2px solid grey;
    border-radius: 7px;
    width: 70%;
    padding: 10px;
}

.table-responsive {
    overflow-x: auto;
}

        .right-equipment-container {
            margin: 5px auto;
            border: 1px solid #ccc;
            border-radius: 10px;
            background-color: white;
            padding: 15px; /* Optional: add padding for better spacing inside the container */
        }

        .left-equipment-container {
            margin: 10px auto;
            border: 1px solid #ccc;
            border-radius: 10px;
            background-color: #2b2727;
            padding: 15px; /* Optional: add padding for better spacing inside the container */
        }


        .accordion-header {
            background-color: #f7f7f7;
            padding: 0px;
            cursor: pointer;
            font-weight: bold;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between; /* Distributes space between equipment name and button */
            align-items: center; /* Aligns items vertically in the center */
        }

        .equipment-name {
            flex-grow: 1; /* Ensures the name takes up the available space */
            margin-left: 10px;
        }

        .plus-btn {
            margin-left: auto; /* Pushes the button to the far right */
        }

        .accordion-item {
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .accordion-content {
            padding: 10px;
            display: none;
        }

        .accordion-content.open {
            display: block;
        }

        .quantity-container {
            display: flex;
            flex-direction: column; /* Stacks items vertically */
            gap: 10px; /* Adds space between items */
        }

        .subcategory-item {
            display: flex;
            align-items: center; /* Aligns text and button in a row */
        }

        .subcategory-item span {
            margin-right: 10px; /* Adds space between text and button */
        }

        .is-invalid {
            border-color: red;
        }

        .input-container {
            position: relative;
            display: inline-block;
            flex: 1;
        }

        #equipmentDropdown {
            position: absolute;
            top: 100%; /* Position below the search box */
            left: 0;
            z-index: 1000; /* Ensure it appears above other content */
            width: 100%; /* Match the width of the search box */
            max-height: 300px; /* Limit height to avoid overflow */
            overflow-y: auto; /* Add scrollbar if needed */
            background: #fff; /* Background color */
            border: 1px solid #ddd; /* Border color */
            border-radius: 0.25rem; /* Rounded corners */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Drop shadow */
        }

        .table {
            margin-bottom: 0; /* Remove bottom margin */
        }

        .table thead th {
            background-color: #222222; /* Light background for header */
            color: #495057; !important; /* Dark text color */
            font-weight: bold; /* Bold text */
        }

        .table tbody tr:hover {
            background-color: #f1f1f1; /* Highlight row on hover */
        }

        .table td {
            vertical-align: middle; /* Center content vertically */
            padding-right: 6px;
        }

        .quantity-input {
            width: 100px; /* Fixed width for input fields */
        }

        .disabled-option {
            background-color: #e9ecef; /* Light gray background for disabled rows */
            color: #6c757d; /* Gray text color */
        }

        .table-container {
            max-height: 430px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }

        .table {
            width: 100%;
            margin-bottom: 0;
        }

        .table thead {
            background-color: #343a40;
            color: #fff;
        }

        .table tbody tr td {
            vertical-align: middle;
        }

        .table tbody tr td input[type="number"] {
            width: 80px;
            text-align: center;
        }

        .table tbody tr td .delete-btn {
            color: #dc3545;
            cursor: pointer;
        }

        .table tbody tr td .delete-btn:hover {
            color: #a71d2a;
        }

        .table-striped tbody tr:nth-of-type(odd) {
            background-color: #f2f2f2;
        }

        .table-bordered {
            border: 1px solid #dee2e6;
        }


        .search-container {
            display: flex;
            align-items: center; /* Align items vertically center */
            justify-content: space-between; /* Space between the items */
            margin-bottom: 10px; /* Space below the search container */
            width: 100%;
        }

        .quantity-container {
            display: flex;
        {#align-items: center; /* Center the quantity input vertically */#} margin-bottom: 10px; /* Space below the quantity input */
            margin-top: 10px;
        {#margin-left: 24px;#}
        }

        .table-container {
            margin-top: 3px; /* Adjust as needed */
        }

        .custom-table {
            width: 100%; /* Ensure table takes full width of its container */
            border-collapse: collapse;
        }

        .custom-table th, .custom-table td {
            text-align: left; /* Align text to the left */
            padding: 1px; /* Padding for table cells */
            padding-left: 48px;
        }

        .custom-table th {
            background-color: #f2f2f2; /* Background color for header */
        }

        body {
            font-family: Arial, sans-serif;
        }

        .form-container {
            width: 100%;
            max-width: 100%;
            height: 100%;
            max-height: 100%;
            margin: 0px auto;
            padding: 0 20px 20px 20px;
        {#border: 1px solid #ccc;#}{#border-radius: 10px;#} background-color: white;
        }

        .step-buttons {
            text-align: center;
            margin-bottom: 15px;
            margin-left: -20px;
        {#border-top: 1px solid #E6E6E6;#} margin-right: -20px;
        }

        .step-btn {
            position: relative;
            padding: 10px 20px;
            margin: 20px 0 0 0;
            border: none;
            border-radius: 25px;
            background-color: #0d99ff;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .step-btn:hover {
            background-color: #0056b3;
        }

        .step-btn.active {
            background-color: green;
        }

        .step-btn:not(:last-child) {
            margin-right: 16px;
        }

        .step-btn:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 50%;
            right: -20px;
            width: 21px;
            height: 2px;
            background-color: #0d99ff;
            z-index: 1;
            transform: translateY(-50%);
        }

        .step-btn.active::after {
            background-color: green; /* Line color when the button is active */
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
        }

        .custom-width {
            width: 151px;
        }

        .form-job {
            font-size: 1rem;
            font-weight: 500;
            color: #0c0c0c;
        }

        .venue-address-item {
            width: 500px;
            white-space: normal;
            word-wrap: break-word;
            display: block;
        }

        {#label {#}
        {#    display: block;#}
        {#    margin-top: 10px;#}
        {# }#}

        input {
            width: 100%;
        {#padding: 10px;#} margin-top: 5px;
            box-sizing: border-box;
        }

        /* Media Queries */
        @media (max-width: 768px) {
            .step-buttons {
                flex-direction: column;
            }

            .step-btn:not(:last-child) {
                margin-right: 0;
                margin-bottom: 10px;
            }

            .custom-width {
                width: 100%; /* Full width on small screens */
                max-width: none;
            }

        {#.venue-address-item {#}
        {#    width: 100%;#}
        {# }#}
        }

        @media (max-width: 400px) {
            .form-container {
                width: 95%;
                padding: 15px;
            }

            .step-btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }

            input {
                padding: 8px;
            }
        }
    </style>
    <script>
        function validateStep(currentStep, nextStep) {
            const currentStepInputs = document.querySelectorAll(`#step-${currentStep} input[required], #step-${currentStep} select[required]`);

            let valid = true;

            currentStepInputs.forEach(input => {
                if (!input.value.trim()) {
                    input.classList.add('is-invalid');
                    valid = false;
                } else {
                    input.classList.remove('is-invalid');
                }
            });

            if (valid) {
                showStep(nextStep);
            } else {
                alert("Please fill in all required fields before proceeding.");
            }
        }

        function showStep(step) {
            document.querySelectorAll('.form-step').forEach(stepElement => {
                stepElement.style.display = 'none';
            });
            document.getElementById(`step-${step}`).style.display = 'block';
        }

        // Ensure the first step is always active on page load
        window.onload = function () {
            showStep(1);
        }


        $(document).ready(function () {

            fetchClientName();
            fetchVenueAddress();
            fetchVenueName();
            fetchMasterCategories();



        // General Details Section
            // Call this function on page load with the initial status value
            var initialStatus = $('#statusType').val();
            updateFieldsBasedOnStatus(initialStatus);

            function getJobIdFromURL() {
                var url = window.location.href;
                var urlObj = new URL(url);
                var pathSegments = urlObj.pathname.split('/');
                var jobIdIndex = pathSegments.indexOf('edit_job') + 1;
                return jobIdIndex > 0 ? pathSegments[jobIdIndex] : null;
            }
            var jobId = getJobIdFromURL(); // Implement this function to get jobId from the URL
            console.log('Fetch the jobId:', jobId);

            if (jobId) {
                $.ajax({
                    url: `/get_temp_details/${jobId}/`,
                    type: 'GET',
                    dataType: 'json',
                    success: function (data) {
                        if (data.error) {
                            console.log(data.error);
                        } else {
                            console.log('Fetch the DATA:', data);
                            // Populate form fields with data from the response
                            $('#titleInput').val(data.title);
                            $('#clientNameDropdown').val(data.client_name);
                            $('#clientContactName').val(data.contact_person_name);
                            $('#clientContactNumber').val(data.contact_person_number);
                            $('#statusType').val(data.status);
                            $('#crewQuantity').val(data.crew_type);
                            $('#venueAddressDropdown').val(data.venue_name);
                            $('#venueAddressInput').val(data.venue_address);
                            $('#prepDate').val(data.setup_date);
                            $('#outDate').val(data.rehearsal_date);
                            $('#showStart').val(data.event_date);
                            $('#showEnd').val(data.dismantle_date);
                            $('#number_of_days').val(data.total_days);
                            $('#total_amount').val(data.amount_row);
                            $('#discount').val(data.discount);
                            $('#discounted_amount').val(data.amount_after_discount);
                            $('#total_amount_cal').val(data.total_amount);
                            console.log('Fetch the details:', data.status);

                            // Handle employee_name, assuming it's a comma-separated string
                            console.log('Original employee data:', data.employee);
                            const employeeName = data.employee ? data.employee.split(',').map(name => name.trim()) : [];
                            console.log('employeeNames show:', employeeName);
                            $('#employeeName').val(employeeName).trigger('change');

                            // Call the function to update fields based on the fetched status
                            updateFieldsBasedOnStatus(data.status);

                            // Fetch individual names for the client
                            fetchIndividualNames(data.contact_person_name);
                        }
                    },
                    error: function (xhr, status, error) {
                        console.log('AJAX Error: ' + status + error);
                    }
                });
            }

            function fetchEmployeeNames() {
                $.ajax({
                    url: '/get_employee_name/',
                    type: 'GET',
                    success: function (response) {
                        var employeeDropdown = $('#employeeName');
                        employeeDropdown.empty(); // Clear existing options
                        employeeDropdown.append('<option value="" data-display="Select">Select</option>');

                        // Populate the dropdown with new options
                        response.employee_names.forEach(function (employee) {
                            employeeDropdown.append('<option value="' + employee.name + '">' + employee.name + '</option>');
                        });

                        // Process and set existing values
                        const fetchedEmployeeData = employeeNames; // This should come from your actual data source
                        const employeeNames = processEmployeeData(fetchedEmployeeData);

                        // Set the selected values
                        if (employeeNames.length > 0) {
                            $('#employeeName').val(employeeNames).trigger('change');
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('Failed to fetch employee names:', error);
                    }
                });
            }

            function processEmployeeData(employeeData) {
                return employeeData.replace(/\n/g, '').split(',').map(name => name.trim());
            }

            // Call fetchEmployeeNames to populate the dropdown
            fetchEmployeeNames();

            function fetchClientName() {
                $.ajax({
                    url: '/fetch_client_name/',
                    type: 'GET',
                    dataType: 'json',
                    success: function (data) {
                        var clientNames = data.client_names;
                        var dropdownMenu = $('#clientNameDropdown').next('.dropdown-menu');
                        dropdownMenu.empty();

                        $.each(clientNames, function (index, client) {
                            dropdownMenu.append('<li><a class="dropdown-item client-name-item" href="#" data-client-name="' + client.name + '" data-client-type="' + client.type + '">' + client.name + '</a></li>');
                            console.log('name', client.name, client.type);
                        });
                    },
                    error: function (xhr, status, error) {
                        console.error('Error fetching client names:', error);
                    }
                });
            }

            function fetchIndividualNames(clientName) {
                $.ajax({
                    url: '/fetch_individual_names/',
                    type: 'GET',
                    data: {client_name: clientName},
                    dataType: 'json',
                    success: function (data) {
                        var individualNames = data.individual_names;
                        var contactDropdown = $('#clientContactName');
                        contactDropdown.empty(); // Ensure dropdown is empty before adding options

                        // Add options to the dropdown
                        $.each(individualNames, function (index, person) {
                            contactDropdown.append('<option value="' + person.name + '" data-mobile="' + person.mobile + '">' + person.name + '</option>');
                        });

                        // Optionally, trigger change event if needed
                        contactDropdown.trigger('change');
                    },
                    error: function (xhr, status, error) {
                        console.error('Error fetching individual names:', error);
                    }
                });
            }

            $(document).on('change', '#clientContactName', function () {
                var selectedOption = $(this).find('option:selected');
                var mobileNumber = selectedOption.data('mobile');
                $('#clientContactNumber').val(mobileNumber);
            });

            $(document).on('click', '.client-name-item', function () {
                var clientName = $(this).data('client-name');
                var clientType = $(this).data('client-type');
                var input = $(this).closest('.dropdown').find('.dropdown-toggle');
                input.val(clientName);
                input.dropdown('toggle');
                // Fetch and populate individual names based on selected client
                fetchIndividualNames(clientName);
            });

            $('#venueAddressDropdown').on('keyup', function () {
                var query = $(this).val();
                if (query.length > 0) {  // Start searching after a few characters
                    fetchVenueName(query);
                } else {
                    $('#dropdown-item').empty(); // Clear the dropdown if input is empty
                }
            });

            $(document).on('click', '.venue-name-item', function (e) {
                e.preventDefault();
                var venueName = $(this).data('venue-name');
                $('#venueAddressDropdown').val(venueName);  // Set the selected venue name in the input
                fetchVenueAddress(venueName);  // Fetch the corresponding venue address
                $('#dropdown-item').empty();  // Clear the dropdown after selection
            });

            function fetchVenueName(query) {
                $.ajax({
                    url: '/fetch_venue_name/',  // Your Django view URL for fetching venue names
                    type: 'GET',
                    data: {'query': query},  // Pass the query to the server
                    dataType: 'json',
                    success: function (data) {
                        var venueNames = data.venue_names;
                        var dropdownMenu = $('#dropdown-item');
                        dropdownMenu.empty();  // Clear the dropdown before appending new data

                        $.each(venueNames, function (index, venue) {
                            dropdownMenu.append('<li><a class="dropdown-item venue-name-item" href="#" data-venue-name="' + venue.name + '">' + venue.name + '</a></li>');
                        });
                    },
                    error: function (xhr, status, error) {
                        console.error('Error fetching venue names:', error);
                    }
                });
            }

            function fetchVenueAddress(venueNames) {
                $.ajax({
                    url: '/fetch_venue_address/',  // Your Django view URL for fetching venue addresses
                    type: 'GET',
                    data: {'venue_name': venueNames},  // Pass the selected venue name to the server
                    dataType: 'json',
                    success: function (data) {
                        if (data.venue_address) {
                            $('#venueAddressInput').val(data.venue_address);  // Set the venue address in the input
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('Error fetching venue address:', error);
                    }
                });
            }

            $('#venueAddressDropdown').on('keyup', function () {
                var value = $(this).val().toLowerCase();
                var dropdownMenu = $(this).next('.dropdown-menu');
                dropdownMenu.children('.dropdown-item').filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
                });
            });

            // Function to update fields based on status value
            function updateFieldsBasedOnStatus(status) {
                if (status === "Quotation") {
                    $('#quotation-fields').show();
                    $('#quotation-details').show();
                    $('#quotation-fields1').show();
                    $('#prepsheet-fields').hide();
                    $('#nav-general_details').show();
                    $('#general_Information').show();
                    $('#nav-crew_allocation').hide();
                    $('#nav-transportation_allocation').hide();
                    $('#nav-add_sub_vendor').hide();
                } else if (status === "Perfoma") {
                    $('#quotation-fields1').show();
                    $('#quotation-fields').hide();
                    $('#prepsheet-fields').hide();
                    $('#nav-general_details').show();
                    $('#nav-add_equipment').show();
                    $('#nav-add_sub_vendor').hide();
                    $('#nav-crew_allocation').hide();
                    $('#nav-transportation_allocation').hide();
                } else if (status === "Prepsheet") {
                    $('#quotation-fields').hide();
                    $('#prepsheet-fields').show();
                    $('#quotation-fields1').hide();
                    $('#nav-general_details').show();
                    $('#nav-add_equipment').show();
                    $('#nav-add_sub_vendor').show();
                    $('#nav-crew_allocation').show();
                    $('#nav-transportation_allocation').show();
                    fetchEmployeeNames(); // Ensure this function is defined elsewhere
                } else {
                    $('#quotation-fields').hide();
                    $('#prepsheet-fields').hide();
                    $('#quotation-fields1').hide();
                    $('#nav-general_details').show();
                    $('#nav-add_equipment').show();
                    $('#nav-add_sub_vendor').show();
                    $('#nav-crew_allocation').show();
                    $('#nav-transportation_allocation').show();
                }
            }

            // Event handler for status change
            $('#statusType').change(function () {
                var selectedValue = $(this).val();
                updateFieldsBasedOnStatus(selectedValue);
            });

            $('#showStart').change(function () {
                var startDate = $(this).val();
                $('#showEnd').attr('min', startDate);
                validateDates();
            });

            $('#showEnd').change(function () {
                validateDates();
            });

            function validateDates() {
                var showStartDate = $('#showStart').val();
                var showEndDate = $('#showEnd').val();

                if (showStartDate && showEndDate) {
                    if (new Date(showEndDate) < new Date(showStartDate)) {
                        alert("Select a valid date. Show End Date cannot be before Show Start Date.");
                        $('#showEnd').val('');
                        $('#number_of_days').val('');  // Clear number_of_days if dates are invalid
                    }
                }
            }

            function updateTempDetails() {
                var jobId = getJobIdFromURL(); // Implement this function to get jobId from the URL

                var employeeName = $('#employeeName').val(); // Get the selected crew types as an array
                var employeeNameString = employeeName.join(', ');

                var formData = {
                    status: $('#statusType').val(),
                    title: $('#titleInput').val(),
                    client_name: $('#clientNameDropdown').val(),
                    contact_person_name: $('#clientContactName').val(),
                    contact_person_number: $('#clientContactNumber').val(),
                    crew_quantity: $('#crewQuantity').val(),
                    employee_name: employeeNameString, // Use the comma-separated string
                    venue_name: $('#venueAddressDropdown').val(),
                    venue_address: $('#venueAddressInput').val(),
                    setup_date: $('#prepDate').val(),
                    rehearsal_date: $('#outDate').val(),
                    event_date: $('#showStart').val(),
                    dismantle_date: $('#showEnd').val(),
                    total_days: $('#number_of_days').val(),
                    amount_row: $('#total_amount').val(),
                    discount: $('#discount').val(),
                    amount_after_discount: $('#discounted_amount').val(),
                    total_amount: $('#total_amount_cal').val(),
                    csrfmiddlewaretoken: $('input[name="csrfmiddlewaretoken"]').val()
                };

                $.ajax({
                    url: `/update_temp_details/${jobId}/`,
                    type: 'POST',
                    data: formData,
                    success: function(response) {
                        if (response.success) {
                            console.log('Details updated successfully');
                            alert('General Details Updated Successfully.')
                            location.reload();
                            // Optionally, you can add code here to give feedback to the user
                        } else {
                            console.log('Error updating details');
                        }
                    },
                    error: function(xhr, status, error) {
                        console.log('AJAX Error: ' + status + error);
                    }
                });
            }

            // Initialize Select2
            $('#employeeName').select2({
                placeholder: "Select Employee Name",
                allowClear: true,
                multiple: true
            });

            // Call this function when the form is submitted or when the status is changed
            $('#statusType').change(function() {
                var status = $(this).val();

                if (status === 'Quotation') {
                    $('#discount, #total_amount').on('input', function() {
                        updateTempDetails();
                    });
                } else if (status === 'Perfoma') {
                    $('#total_amount').on('input', function() {
                        updateTempDetails();
                    });
                } else if (status === 'Prepsheet') {
                    $('#employeeName').on('input', function() {
                        updateTempDetails();
                    });
                } else {
                    updateTempDetails();
                }

            });


        // Equipment Details Section
            // AJAX call to calculate the total amount
            $.ajax({
                url: `/calculate-total-amount/${jobId}/`, // Django URL pattern
                type: 'GET',
                success: function(response) {
                    // Step 5: Update the total amount in the input field
                    $('#total_amount').val(response.total_amount);
                },
                error: function(error) {
                    console.error('Error fetching total amount:', error);
                }
            });

            // Function to calculate discount and total amounts
            function calculateAmounts() {
                // Get the values of the total amount and discount
                var totalAmount = parseFloat($('#total_amount').val());
                var discount = parseFloat($('#discount').val());

                // Check if both totalAmount and discount are numbers
                if (!isNaN(totalAmount) && !isNaN(discount)) {
                    // Calculate the discounted amount
                    var discountedAmount = totalAmount - (totalAmount * discount / 100);
                    $('#discounted_amount').val(discountedAmount.toFixed(2));

                    // Calculate the total amount with GST
                    var totalAmountWithGST = discountedAmount * 1.18;
                    $('#total_amount_cal').val(totalAmountWithGST.toFixed(2));
                }
            }

            // Trigger the calculation when the discount value changes
            $('#discount').on('input', function() {
                calculateAmounts();
            });

            // You can also trigger the calculation when the total amount changes
            $('#total_amount').on('input', function() {
                calculateAmounts();
            });

            // Variable to keep track of timeout ID
            let timeoutId;

            $('#searchCategory').on('input', function () {
                var query = $(this).val();
                var dropdown = $('#equipmentDropdown');

                if (query.length > 1) {
                    $.ajax({
                        url: '/search-equipment/',
                        data: {'query': query},
                        success: function (data) {
                            dropdown.empty(); // Clear previous results
                            if (data.length > 0) {
                                var table = '<table class="table table-bordered"><thead><tr><th>Equipment</th><th>Available</th><th>Quantity</th></tr></thead><tbody>';
                                data.forEach(function (item) {
                                    var disabledClass = item.available_quantity === 0 ? 'disabled-option' : '';
                                    table += `
                            <tr class="${disabledClass}">
                                <td>${item.equipment_name}</td>
                                <td style="text-align: center;">${item.available_quantity}</td>
                                <td>
                                    <input type="number" class="form-control quantity-input-dropdown" data-equipment-name="${item.equipment_name}" data-available-quantity="${item.available_quantity}" min="1" max="${item.available_quantity}" placeholder="Enter quantity" style="width: 73px;">
                                </td>
                            </tr>`;
                                });
                                table += '</tbody></table>';
                                dropdown.html(table); // Use html() instead of append()
                                dropdown.show();
                            } else {
                                dropdown.hide();
                            }
                        }
                    });
                } else {
                    dropdown.hide();
                }
            });

            // Event handler for quantity input change within the dropdown table
            $(document).on('input', '#equipmentDropdown .quantity-input-dropdown', function () {
                // Clear any existing timeout
                clearTimeout(timeoutId);

                // Set a new timeout
                timeoutId = setTimeout(() => {
                    var quantity = parseInt($(this).val(), 10);
                    var availableQuantity = parseInt($(this).data('available-quantity'), 10);
                    var equipmentName = $(this).data('equipment-name');

                    if (isNaN(quantity) || quantity <= 0) {
                        return; // Exit if the input is not a valid number or less than 1
                    }

                    if (quantity > availableQuantity) {
                        alert('The requested quantity is not available in stock.');
                        $(this).val(''); // Clear the quantity input field
                    } else {
                        var row = $('#selectedEquipmentTable tbody tr').filter(function () {
                            return $(this).find('td:first').text() === equipmentName;
                        });

                        if (row.length > 0) {
                            // If the row already exists, update the quantity
                            row.find('.quantity-input-selected').val(quantity);
                        } else {
                            // Add a new row to the selected equipment table with the equipment name and quantity
                            var newRow = `
                    <tr>
                        <td class="equipment-name">${equipmentName}</td>
                        <td>
                            <input type="number" class="form-control quantity-input-selected" value="${quantity}" max="${availableQuantity}" style="width: 100px; padding-left: 14px;">
                        </td>
                    </tr>`;
                            $('#selectedEquipmentTable tbody').append(newRow);
                        }

                        // Clear the quantity input field after adding or updating
                        $(this).val('');
                    }
                }, 500); // Delay of 500 milliseconds
            });

            // Event handler for quantity input change within the selected equipment table
            $(document).on('input', '#selectedEquipmentTable .quantity-input-selected', function () {
                var quantity = parseInt($(this).val(), 10);
                var equipmentName = $(this).closest('tr').find('td:first').text();

                if (isNaN(quantity) || quantity < 0) {
                    return; // Exit if the input is not a valid number or less than 0
                }

                if (quantity === 0) {
                    // Remove the row from #selectedEquipmentTable if quantity is 0
                    $(this).closest('tr').remove();
                }
            });

            // Hide the dropdown when clicking outside
            $(document).on('click', function (e) {
                if (!$(e.target).closest('.input-container').length) {
                    $('#equipmentDropdown').hide();
                }
            });

            function fetchMasterCategories() {
                $.ajax({
                    url: '/fetch_master_categories/',
                    type: 'GET',
                    success: function (data) {
                        console.log('Fetched Master Category Names:', data);
                        var masterCategories = data.master_categories;
                        window.masterCategories = masterCategories;
                    },
                    error: function (xhr, status, error) {
                        console.error('Error fetching master categories:', error);
                    }
                });
            }

            function loadSubcategories() {
                $.ajax({
                    url: '/fetch-all-subcategories/',
                    type: 'GET',
                    success: function (response) {
                        $('.quantity-container').empty();  // Clear the container

                        // Create the accordion structure
                        $('.quantity-container').append('<div id="accordion"></div>');
                        const accordion = $('#accordion');

                        // Populate the accordion with fetched subcategories
                        $.each(response, function (index, subcategory) {
                            accordion.append(`
                                <div class="accordion-item" style="width: 100%;">
                                    <div class="accordion-header" data-target="${subcategory.id}">
                                        <span class="equipment-name">${subcategory.name}</span>
                                        <button type="button" class="btn btn-success plus-btn" style="background-color: #0d99ff;" data-target="${subcategory.id}">+</button>
                                    </div>
                                    <div class="accordion-content" id="content-${subcategory.id}" style="display: none;">
                                        <!-- Additional details can be inserted here -->
                                    </div>
                                </div>
                            `);
                        });

                        // Add event listener to handle button click
                        $('.plus-btn').on('click', function() {
                            const contentId = $(this).data('target');
                            const contentElement = $(`#content-${contentId}`);

                            if (contentElement.is(':visible')) {
                                contentElement.slideUp();  // Hide the content
                            } else {
                                contentElement.slideDown();  // Show the content
                            }
                        });
                    },
                    error: function(error) {
                        console.error('Error fetching subcategories:', error);
                    }
                });
            }

            // Load all subcategories on page load
            loadSubcategories();

            // Event listener for plus button
            $(document).on('click', '.plus-btn', function() {
                // Extract the numeric equipment ID from the data-target attribute
                const equipmentId = $(this).closest('.accordion-header').data('target');

                $.ajax({
                    url: '/fetch-equipment-with-barcodes/',  // URL should match your Django URL configuration
                    type: 'GET',
                    data: { equipment_id: equipmentId },
                    success: function(response) {
                        if (response.length > 0) {
                            let contentHtml = '';
                            $.each(response, function(index, equipment) {
                                contentHtml += `<p style="padding: 0px; text-align: center; border-bottom: 1px solid #ccc;">${equipment.equipment_name}</p>`;
                            });

                            // Display the equipment names directly
                            $(`#content-${equipmentId}`).html(contentHtml).addClass('open');
                        } else {
                            $(`#content-${equipmentId}`).html('<p>No equipment available.</p>').addClass('open');
                        }
                    },
                    error: function(error) {
                        console.error('Error fetching equipment names:', error);
                    }
                });
            });

            $(document).on('input', '.quantity-input-sub-category', function () {
                var $inputField = $(this);
                var quantity = parseInt($inputField.val(), 10);
                var availableQuantity = parseInt($inputField.closest('tr').find('td[data-available-quantity]').data('available-quantity'), 10);
                var equipmentName = $inputField.closest('tr').find('td:first').text();

                if (isNaN(quantity) || quantity < 0) {
                    return; // Exit if the input is not a valid number or less than 0
                }

                if (quantity > availableQuantity) {
                    alert('The requested quantity exceeds the available quantity.');
                    $inputField.val(''); // Clear the quantity input field
                    return;
                }

                setTimeout(function () {
                    var existingRow = $('#selectedEquipmentTable tbody tr').filter(function() {
                        return $(this).find('td:first').text() === equipmentName;
                    });

                    if (existingRow.length > 0) {
                        if (quantity === 0) {
                            existingRow.remove();
                        } else {
                            existingRow.find('td:eq(1) input').val(quantity);
                        }
                    } else {
                        if (quantity > 0) {
                            var newRow = `
                                <tr data-id="${item.id}">
                                    <td style="text-align: left;">${equipmentName}</td>
                                    <td style="text-align: left;">
                                        <input type="text" class="form-control quantity-input" value="${quantity}" style="text-align: center; padding-left: 0px;" />
                                    </td>
                                </tr>
                            `;
                            $('#selectedEquipmentTable tbody').append(newRow);

                            // Automatically open the Equipment Search accordion section
                            var equipmentSearchAccordion = $('#collapseOne');
                            if (!equipmentSearchAccordion.hasClass('show')) {
                                equipmentSearchAccordion.collapse('show'); // Open the accordion
                            }
                        }
                    }

                    $inputField.val('');
                }, 500);
            });

            $(document).on('input', '.quantity-input', function () {
                var $inputField = $(this);
                var quantity = parseInt($inputField.val(), 10);

                if (quantity === 0) {
                    $inputField.closest('tr').remove();
                }
            });

            // AJAX call to fetch the equipment details
            $.ajax({
                url: '/fetch-equipment-details/' + jobId + '/',
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    var tableBody = $('#selectedEquipmentTable tbody');
                    tableBody.empty(); // Clear the table body

                    // Loop through the data and append rows to the table
                    data.forEach(function(item) {
                        var id = item.id;
                        var equipmentName = item.equipment_name;
                        var quantity = parseInt(item.quantity, 10);
                        console.log('Fetch the ID:', id)

                        // Check if the row already exists
                        var existingRow = tableBody.find('tr').filter(function() {
                            return $(this).find('td:first').text() === equipmentName;
                        });

                        if (existingRow.length > 0) {
                            if (quantity === 0) {
                                existingRow.remove();
                            } else {
                                existingRow.find('td:eq(1) input.quantity-input').val(quantity);
                                existingRow.find('input[type="hidden"]').val(id);
                            }
                        } else {
                            if (quantity > 0) {
                                var newRow = `
                                    <tr>
                                        <td style="text-align: left;">${equipmentName}</td>
                                        <td style="text-align: left;">
                                            <input type="text" class="form-control quantity-input" value="${quantity}" style="text-align: center; padding-left: 0px;" />
                                            <input type="hidden" class="equipment-id" value="${id}" />
                                        </td>
                                    </tr>
                                `;
                                tableBody.append(newRow);
                            }
                        }
                    });
                },
                error: function(error) {
                    console.log('Error fetching equipment details:', error);
                }
            });

            $('#selectedEquipmentTable').on('input', '.quantity-input-selected', function () {
                const lastRow = $('#selectedEquipmentTable tbody tr:last-child');

                // Check if the change occurred in the last input field of the last row
                if ($(this).closest('tr').is(lastRow)) {
                    if (jobId) {
                        insertEquipmentDetails(jobId); // Pass jobId directly to the function
                    } else {
                        alert('Job ID is not available. Please insert temp data first.');
                    }
                }
            });

            $(document).on('input', '.quantity-input', function () {
                var $inputField = $(this);
                var newQuantity = parseInt($inputField.val(), 10);
                var row = $inputField.closest('tr');
                var id = row.find('input[type="hidden"].equipment-id').val(); // Fetch the ID from the hidden input field

                if (isNaN(newQuantity)) {
                    return; // Exit if the input is not a valid number
                }

                if (newQuantity < 0) {
                    // Optionally handle negative numbers if needed
                    return;
                }

                // Send an AJAX request to update or delete the row based on the quantity
                $.ajax({
                    url: '/update-equipment-quantity/',  // Adjust URL to match your view
                    type: 'POST',
                    data: {
                        'id': id,
                        'quantity': newQuantity
                    },
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}' // Include CSRF token if CSRF protection is enabled
                    },
                    success: function(response) {
                        if (newQuantity === 0) {
                            // Remove the row from the table if quantity is 0
                            row.remove();
                        }
                        console.log('Quantity updated successfully:', response);

                    },
                    error: function(xhr, status, error) {
                        console.error('Error updating quantity:', error);
                        // Optionally handle the error case (e.g., revert the input)
                    }
                });
            });

            // Function to insert equipment details
            function insertEquipmentDetails(jobId) {
                const equipmentDetails = [];
                $('#selectedEquipmentTable tbody tr').each(function () {
                    const row = $(this);
                    const quantity = row.find('.quantity-input-selected').val(); // Make sure to retrieve the quantity value correctly

                    // Check if quantity is available and is a valid number
                    if (quantity && !isNaN(quantity)) {
                        equipmentDetails.push({
                            temp_id: jobId, // Use jobId directly here
                            equipment_name: row.find('.equipment-name').text(),
                            quantity: parseInt(quantity, 10), // Ensure the quantity is sent as a number
                        });
                    } else {
                        console.error('Invalid or missing quantity for equipment:', row.find('.equipment-name').text());
                    }
                });

                $.ajax({
                    url: '/insert-equipment-details/',
                    type: 'POST',
                    data: JSON.stringify({ equipmentDetails: equipmentDetails }),
                    contentType: 'application/json',
                    success: function (response) {
                        if (response.status === 'success') {
                            alert('Equipment details inserted successfully');
                        } else {
                            alert('Error inserting equipment details: ' + response.error);
                        }
                    },
                    error: function (error) {
                        alert('Error inserting equipment details');
                        console.log(error);
                    }
                });
            }

    // Sub Vendor Section
            // Function to add a new row when the button is clicked
            $('#add-sub-vendor-row-btn').click(function (event) {
                event.preventDefault();
                // Create the new row HTML
                var newRow = `
                    <tr>
                        <td>
                            <input type="text" name="vendor-name" placeholder="Vendor Name" class="form-control">
                        </td>
                        <td>
                            <input type="text" name="equipment-name" placeholder="Equipment Name" class="form-control">
                        </td>
                        <td>
                            <input type="number" name="quantity" placeholder="Quantity" class="form-control">
                        </td>
                        <td>
                            <button class="btn btn-sm btn-primary save-sub-vendor-row me-2" data-toggle="tooltip" title="Save Sub Vendor Row" id="insertSubVendor" style="background-color: #0d99ff;">
                                <i class="fa fa-check"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-danger remove-sub-vendor-row me-2" data-toggle="tooltip" title="Delete Sub Vendor Row" style="background-color: #ff5e5e;">
                                <i class="fa fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;

                // Append the new row to the table body
                $('#sub-vendor-table tbody').append(newRow);
            });

            // AJAX call to fetch the sub-vendor details
            $.ajax({
                url: '/fetch-sub-vendor-details/' + jobId + '/',
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    var tableBody = $('#sub-vendor-table tbody');
                    tableBody.empty(); // Clear the table body

                    // Loop through the data and append rows to the table in the desired format
                    data.forEach(function(item) {
                        var newRow = `
                            <tr data-id="${item.id}"> <!-- Store the ID in a data attribute -->
                                <td>
                                    <input type="text" name="vendor-name" value="${item.vendor_name}" placeholder="Vendor Name" class="form-control">
                                </td>
                                <td>
                                    <input type="text" name="equipment-name" value="${item.sub_equipment_name}" placeholder="Equipment Name" class="form-control">
                                </td>
                                <td>
                                    <input type="number" name="quantity" value="${item.sub_quantity}" placeholder="Quantity" class="form-control">
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-primary update-sub-vendor-row me-2" data-toggle="tooltip" title="Update Sub Vendor Row" id="insertSubVendor" style="background-color: #0d99ff;">
                                        <i class="fa fa-check"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-danger delete-sub-vendor-row me-2" data-toggle="tooltip" title="Delete Sub Vendor Row" style="background-color: #ff5e5e;">
                                        <i class="fa fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `;
                        tableBody.append(newRow);
                    });
                },
                error: function(error) {
                    console.log('Error fetching sub-vendor details:', error);
                }
            });

            // Example function to handle saving changes
            $(document).on('click', '.update-sub-vendor-row', function() {
                var row = $(this).closest('tr');
                var id = row.data('id'); // Retrieve the ID from the data attribute
                var vendorName = row.find('input[name="vendor-name"]').val();
                var equipmentName = row.find('input[name="equipment-name"]').val();
                var quantity = row.find('input[name="quantity"]').val();

                // Perform the AJAX request to update the row
                $.ajax({
                    url: '/update-sub-vendor-details/', // Ensure this URL matches your Django URL pattern
                    type: 'POST',
                    data: JSON.stringify({
                        id: id,
                        vendor_name: vendorName,
                        equipment_name: equipmentName,
                        quantity: quantity
                    }),
                    contentType: 'application/json',
                    success: function(response) {
                        if (response.status === 'success') {
                            alert('Sub-vendor details updated successfully');
                        } else {
                            alert('Error updating sub-vendor details: ' + response.error);
                        }
                    },
                    error: function(error) {
                        alert('Error updating sub-vendor details');
                        console.log(error);
                    }
                });
            });

            $('#sub-vendor-table').on('click', '.save-sub-vendor-row', function(event) {
                event.preventDefault(); // Prevent the form submission

                const row = $(this).closest('tr');
                const subVendorDetails = {
                    temp_id: jobId,  // Ensure tempId is correctly defined
                    vendor_name: row.find('input[name="vendor-name"]').val(),
                    sub_equipment_name: row.find('input[name="equipment-name"]').val(),
                    sub_quantity: row.find('input[name="quantity"]').val(),
                };

                // Check the structure before sending
                console.log('Sending Data:', subVendorDetails);

                $.ajax({
                    url: '/insert-sub-vendor-details/',  // Ensure this URL is correct
                    type: 'POST',
                    data: JSON.stringify(subVendorDetails),
                    contentType: 'application/json',
                    success: function(response) {
                        if (response.status === 'success') {
                            alert('Sub-vendor details inserted successfully');
                        } else {
                            alert('Error inserting sub-vendor details: ' + response.error);
                        }
                    },
                    error: function(error) {
                        alert('Error inserting sub-vendor details');
                        console.log(error);
                    }
                });
            });

            $(document).on('click', '.delete-sub-vendor-row', function () {
                var $button = $(this);
                var row = $button.closest('tr'); // Get the closest <tr> element
                var id = row.data('id'); // Fetch the ID from the data attribute

                if (!id) {
                    alert('Invalid ID');
                    return;
                }

                // Confirm the deletion
                if (confirm('Are you sure you want to delete this sub-vendor row?')) {
                    // Send an AJAX request to delete the row
                    $.ajax({
                        url: '/delete-sub-vendor/' + id + '/',
                        type: 'DELETE',
                        headers: {
                            'X-CSRFToken': '{{ csrf_token }}' // Include CSRF token if CSRF protection is enabled
                        },
                        success: function(response) {
                            if (response.success) {
                                row.remove(); // Remove the row from the table
                                alert('Sub-vendor row deleted successfully.');
                            } else {
                                alert('Failed to delete sub-vendor row.');
                            }
                        },
                        error: function(xhr, status, error) {
                            console.error('Error deleting sub-vendor row:', error);
                            alert('Error occurred while deleting sub-vendor row.');
                        }
                    });
                }
            });


// Crew Allocation Section
fetchCrewAllocation(jobId);

function fetchCrewAllocation(jobId) {
    fetch(`/fetch_crew_allocation/?jobId=${jobId}`)
        .then(response => response.json())
        .then(result => {
            if (result.data) {
                populateCrewAllocationTable(result.data);
            } else {
                console.error('Error fetching crew allocation:', result.error);
            }
        })
        .catch(error => console.error('Error:', error));
}

function populateCrewAllocationTable(data) {
    var tableBody = document.getElementById('crew-allocation-table-body');
    tableBody.innerHTML = ''; // Clear any existing rows

    data.forEach(item => {
        var newRowHtml = `
            <tr data-id="${item.id}">
                <td>${item.crew_type}</td>
                <td>${item.employee_name}</td>
                <td>
                    <button class="btn btn-secondary deleteButton" data-id="${item.id}"><i class="fa fa-times"></i></button>
                </td>
            </tr>
        `;
        tableBody.insertAdjacentHTML('beforeend', newRowHtml);
    });

    // Add event listener for delete buttons
    document.querySelectorAll('.deleteButton').forEach(button => {
        button.addEventListener('click', function() {
            var rowId = this.getAttribute('data-id');
            var row = this.closest('tr');

            // Optional: Add confirmation before deleting
            if (confirm('Are you sure you want to delete this row?')) {
                // Remove the row from the table
                row.remove();

                // Send a DELETE request to the server to delete the record
                fetch(`/delete_crew_allocation/${rowId}/`, { method: 'DELETE' })
                    .then(response => response.json())
                    .then(result => {
                        if (result.success) {
                            console.log('Row deleted successfully.');
                        } else {
                            console.error('Error deleting row:', result.error);
                        }
                    })
                    .catch(error => console.error('Error:', error));
            }
        });
    });
}


$('#employeeNameDropdown').on('input', function() {
                    let query = $(this).val();
                    if (query.length > 0) { // Start searching after at least 1 characters
                        $.ajax({
                            url: '/search-employee/',  // Adjust the URL to your Django view
                            data: {
                                'term': query
                            },
                            dataType: 'json',
                            success: function(data) {
                                let dropdown = $('#employeeNameDropdown').siblings('.employee-dropdown-menu');
                                dropdown.empty(); // Clear any existing options

                                if(data.length === 0) {
                                    dropdown.append('<li class="employee-dropdown-item">No results found</li>');
                                } else {
                                    $.each(data, function(index, employee) {
                                        dropdown.append(
                                            `<li class="employee-dropdown-item" data-id="${employee.id}">${employee.name}</li>`
                                        );
                                    });
                                }

                                dropdown.show(); // Show the dropdown
                            }
                        });
                    } else {
                        $('#employeeNameDropdown').siblings('.employee-dropdown-menu').hide(); // Hide the dropdown if input is too short
                    }
                });


// Transporation Allocation Section

fetchTransportationDetails(jobId);

$(document).on('click', '.cancelRow', function() {
    $(this).closest('.transportation-row').remove();
});


function fetchTransportationDetails(jobId) {
    fetch(`/get_transportation_allocation/?jobId=${jobId}`)
        .then(response => response.json())
        .then(data => {
            populateFields(data);
        })
        .catch(error => console.error('Error fetching transportation details:', error));
}

function populateFields(data) {
    var onVehicleFields = document.getElementById('onVehicleFields');
    var outsideVehicleFields = document.getElementById('outsideVehicleFields');

    onVehicleFields.innerHTML = '';
    outsideVehicleFields.innerHTML = '';

    let onVehicleChecked = false;
    let outsideVehicleChecked = false;

    data.forEach(item => {
        if (item.driver_name || item.vehicle_number) {
            onVehicleChecked = true;
            var newRowHtml = `
                <div class="row transportation-row on-vehicle-row" data-id="${item.id}">
                    <div class="col-xl-4 mb-3">
                        <label class="form-label">Driver Name</label>
                        <input type="text" class="form-control" placeholder="Enter Driver Name" name="driver_name" value="${item.driver_name || ''}">
                    </div>
                    <div class="col-xl-3 mb-3">
                        <label class="form-label">Contact Number</label>
                        <input type="number" class="form-control" placeholder="Enter Contact Number" name="contact_number" value="${item.contact_number || ''}">
                    </div>
                    <div class="col-xl-3 mb-3">
                        <label class="form-label">Vehicle Number</label>
                        <input type="text" class="form-control" placeholder="Enter Vehicle Number" name="vehicle_number" value="${item.vehicle_number || ''}">
                    </div>
                    <div class="col-xl-2 mb-3" style="margin-top: 36px;">
                        <button type="button" class="btn btn-success updateRow"><i class="fa fa-save"></i></button>
                        <button type="button" class="btn btn-danger light cancelRow"><i class="fa fa-times"></i></button>
                    </div>
                </div>
            `;
            onVehicleFields.insertAdjacentHTML('beforeend', newRowHtml);
        }

        if (item.outside_driver_name || item.outside_vehicle_number) {
            outsideVehicleChecked = true;
            var newOutSideRowHtml = `
                <div class="row transportation-row outside-vehicle-row" data-id="${item.id}">
                    <div class="col-xl-4 mb-3">
                        <label class="form-label">Outside Driver Name</label>
                        <input type="text" class="form-control" placeholder="Enter Driver Name" name="outside_driver_name" value="${item.outside_driver_name || ''}">
                    </div>
                    <div class="col-xl-3 mb-3">
                        <label class="form-label">Outside Contact Number</label>
                        <input type="number" class="form-control" placeholder="Enter Contact Number" name="outside_contact_number" value="${item.outside_contact_number || ''}">
                    </div>
                    <div class="col-xl-3 mb-3">
                        <label class="form-label">Outside Vehicle Number</label>
                        <input type="text" class="form-control" placeholder="Enter Vehicle Number" name="outside_vehicle_number" value="${item.outside_vehicle_number || ''}">
                    </div>
                    <div class="col-xl-2 mb-3" style="margin-top: 36px;">
                        <button type="button" class="btn btn-success updateRow"><i class="fa fa-save"></i></button>
                        <button type="button" class="btn btn-danger light cancelRow"><i class="fa fa-times"></i></button>
                    </div>
                </div>
            `;
            outsideVehicleFields.insertAdjacentHTML('beforeend', newOutSideRowHtml);
        }
    });

    if (onVehicleChecked) {
        document.getElementById('onVehicle').checked = true;
        document.getElementById('onVehicleFields').style.display = 'block';
    }
    if (outsideVehicleChecked) {
        document.getElementById('outsideVehicle').checked = true;
        document.getElementById('outsideVehicleFields').style.display = 'block';
    }

    document.querySelectorAll('input[name="transportation_type"]').forEach(radio => {
        radio.addEventListener('change', function() {
            if (this.value === 'on_vehicle') {
                document.getElementById('onVehicleFields').style.display = 'block';
                document.getElementById('outsideVehicleFields').style.display = 'none';
            } else if (this.value === 'outside_vehicle') {
                document.getElementById('onVehicleFields').style.display = 'none';
                document.getElementById('outsideVehicleFields').style.display = 'block';
            }
        });
    });

    document.querySelector('input[name="transportation_type"]:checked')?.dispatchEvent(new Event('change'));

    document.querySelectorAll('.updateRow').forEach(button => {
        button.addEventListener('click', function() {
            var row = this.closest('.transportation-row');
            var rowId = row.getAttribute('data-id');
            var data = {
                id: rowId,
                driver_name: row.querySelector('input[name="driver_name"]') ? row.querySelector('input[name="driver_name"]').value : null,
                contact_number: row.querySelector('input[name="contact_number"]') ? row.querySelector('input[name="contact_number"]').value : null,
                vehicle_number: row.querySelector('input[name="vehicle_number"]') ? row.querySelector('input[name="vehicle_number"]').value : null,
                outside_driver_name: row.querySelector('input[name="outside_driver_name"]') ? row.querySelector('input[name="outside_driver_name"]').value : null,
                outside_contact_number: row.querySelector('input[name="outside_contact_number"]') ? row.querySelector('input[name="outside_contact_number"]').value : null,
                outside_vehicle_number: row.querySelector('input[name="outside_vehicle_number"]') ? row.querySelector('input[name="outside_vehicle_number"]').value : null
            };
            updateRow(data);
        });
    });

    document.querySelectorAll('.cancelRow').forEach(button => {
        button.addEventListener('click', function() {
            var row = this.closest('.transportation-row');
            var rowId = row.getAttribute('data-id');
            if (confirm('Are you sure you want to delete this row?')) {
                row.remove();
                // Optionally send a request to the server to delete the row
                deleteRow(rowId);
            }
        });
    });
}

function deleteRow(rowId) {
    fetch(`/delete_transportation_allocation/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCsrfToken() // Ensure you have a function to get the CSRF token
        },
        body: JSON.stringify({ id: rowId })
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            alert('Row deleted successfully');
        } else {
            alert('Error deleting row: ' + result.error);
        }
    })
    .catch(error => console.error('Error deleting row:', error));
}

function updateRow(data) {
    fetch(`/update_transportation_allocation/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCsrfToken() // Ensure you have a function to get the CSRF token
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            alert('Row updated successfully');
        } else {
            alert('Error updating row: ' + result.error);
        }
    })
    .catch(error => console.error('Error updating row:', error));
}

function getCsrfToken() {
            const name = 'csrftoken=';
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                let cookie = cookies[i].trim();
                if (cookie.startsWith(name)) {
                    return cookie.substring(name.length, cookie.length);
                }
            }
            return ''; // Return an empty string if CSRF token is not found
        }

// Add new transportation row when "Add More" button is clicked
$('#addTransportation').click(function(event) {
    event.preventDefault(); // Prevent the default form submission

    // Get the selected transportation type
    var transportationType = $('input[name="transportation_type"]:checked').val();

    // Define the HTML for a new row
    var newRowHtml = `
        <div class="row transportation-row ${transportationType === 'on_vehicle' ? 'on-vehicle-row' : 'outside-vehicle-row'}">
            <div class="col-xl-4 mb-3">
                <label class="form-label">${transportationType === 'on_vehicle' ? 'Driver Name' : 'Outside Driver Name'}</label>
                <input type="text" class="form-control" placeholder="Enter Driver Name" name="${transportationType === 'on_vehicle' ? 'driver_name' : 'outside_driver_name'}">
            </div>
            <div class="col-xl-3 mb-3">
                <label class="form-label">${transportationType === 'on_vehicle' ? 'Contact Number' : 'Outside Contact Number'}</label>
                <input type="number" class="form-control" placeholder="Enter Contact Number" name="${transportationType === 'on_vehicle' ? 'contact_number' : 'outside_contact_number'}">
            </div>
            <div class="col-xl-3 mb-3">
                <label class="form-label">${transportationType === 'on_vehicle' ? 'Vehicle Number' : 'Outside Vehicle Number'}</label>
                <input type="text" class="form-control" placeholder="Enter Vehicle Number" name="${transportationType === 'on_vehicle' ? 'vehicle_number' : 'outside_vehicle_number'}">
            </div>
            <div class="col-xl-2 mb-3" style="margin-top: 36px;">
                <button type="button" class="btn btn-success saveRow" data-type="${transportationType}"><i class="fa fa-save"></i></button>
                <button type="button" class="btn btn-danger light cancelRow"><i class="fa fa-times"></i></button>
            </div>
        </div>
    `;

    // Append the new row to the appropriate section
    if (transportationType === 'on_vehicle') {
        $('#onVehicleFields').append(newRowHtml);
    } else if (transportationType === 'outside_vehicle') {
        $('#outsideVehicleFields').append(newRowHtml);
    }
});

// Add event listener to dynamically created 'saveRow' buttons
$(document).on('click', '.saveRow', function(event) {
    var button = $(this);
    var row = button.closest('.row');
    var type = button.data('type'); // Get the type of transportation

    var data = {
        temp_id: jobId,
        driver_name: '',
        contact_number: '',
        vehicle_number: '',
        outside_driver_name: '',
        outside_contact_number: '',
        outside_vehicle_number: ''
    };

    // Collect data based on transportation type
    if (type === 'on_vehicle') {
        data.driver_name = row.find('input[name="driver_name"]').val();
        data.contact_number = row.find('input[name="contact_number"]').val();
        data.vehicle_number = row.find('input[name="vehicle_number"]').val();
    } else if (type === 'outside_vehicle') {
        data.outside_driver_name = row.find('input[name="outside_driver_name"]').val();
        data.outside_contact_number = row.find('input[name="outside_contact_number"]').val();
        data.outside_vehicle_number = row.find('input[name="outside_vehicle_number"]').val();
    }

    $.ajax({
        url: '/insert_transportation/', // Replace with your actual URL
        type: 'POST',
        data: JSON.stringify(data),
        contentType: 'application/json',
        success: function(response) {
            alert('Data saved successfully!');
            // Optionally provide feedback or update the UI without removing the row
        },
        error: function(xhr, status, error) {
            alert('An error occurred: ' + error);
        }
    });
});

           $('#removeButton').click(function(event) {
                    event.preventDefault(); // Prevent the default form submission

                    // Clear the form fields
                    $('#onVehicleFields').find('input').val('');
                    $('#outsideVehicleFields').find('input').val('');

            });


$('#shareAsPdf').click(function () {
                var jobId = getJobIdFromURL(); // Fetch the jobId from the URL
                console.log('Fetch the Job ID:', jobId);

                if (jobId) {
                    $.ajax({
                        url: '/print_jobs/', // Your Django URL for fetching job details
                        type: 'GET',
                        data: { jobId: jobId },
                        success: function (response) {
                            if (response.job && response.job.status) {
                                var status = response.job.status.toLowerCase();
                                if (status === 'quotation') {
                                    // Show dropdown container
                                    $('#dropdown-container').show();

                                    // Handle dropdown item click
                                    $('#dropdown-container .dropdown-item').click(function() {
                                        var selectedOptionId = $(this).attr('id'); // Get the id of the selected option

                                        // Hide the dropdown container after selection
                                        $('#dropdown-container').hide();

                                        // Check the id and call the appropriate function
                                        if (selectedOptionId === "equipmentQuotation") {
                                            $('#delivery-options-container').show();

                                            // Handle the click on the PDF option
                                            $('#delivery-options-container #pdfOption').click(function() {
                                                handleEquipmentQuotationPdf(response);

                                                $('#delivery-options-container').hide(); // Hide options after selection
                                            });

                                            // Handle the click on the Print option
                                            $('#delivery-options-container #printOption').click(function() {
                                                handleEquipmentQuotation(response);

                                                $('#delivery-options-container').hide(); // Hide options after selection
                                            });

                                        } else if (selectedOptionId === "totalQuotation") {
                                            $('#delivery-options-container').show();

                                            // Handle the click on the PDF option
                                            $('#delivery-options-container #pdfOption').click(function() {
                                                handleTotalQuotationPdf(response);

                                                $('#delivery-options-container').hide(); // Hide options after selection
                                            });

                                            // Handle the click on the Print option
                                            $('#delivery-options-container #printOption').click(function() {
                                                handleTotalQuotation(response);

                                                $('#delivery-options-container').hide(); // Hide options after selection
                                            });
                                        }
                                    });

                                } else if (status === 'perfoma') {
                                    handlePerfoma(response);
                                } else if (status === 'prepsheet') {
                                    handlePrepsheet(response);
                                } else if (status === 'delivery challan') {
                                     // Show PDF and Print options
                                    $('#delivery-options-container').show();

                                    // Handle the click on the PDF option
                                    $('#delivery-options-container #pdfOption').click(function() {
                                        handleDeliveryChallanPdf(response);

                                        $('#delivery-options-container').hide(); // Hide options after selection
                                    });

                                    // Handle the click on the Print option
                                    $('#delivery-options-container #printOption').click(function() {
                                        handleDeliveryChallan(response);

                                        $('#delivery-options-container').hide(); // Hide options after selection
                                    });
                                } else {
                                    alert('Unknown status: ' + response.job.status);
                                }
                            } else {
                                alert('Job status not found in response.');
                            }
                        },
                        error: function (error) {
                            console.error('Error fetching job details:', error);
                            alert('Error fetching job details. Please try again.');
                        }
                    });
                } else {
                    alert('No jobId found in URL.');
                }
                 // Hide dropdown if clicking outside of it
                $(document).click(function (event) {
                    if (!$(event.target).closest('#dropdown-container, #shareAsPdf').length) {
                        $('#dropdown-container').hide();
                    }
                });

                // Prevent hiding the dropdown when clicking inside it
                $('#dropdown-container').click(function (event) {
                    event.stopPropagation();
                });
           });

            function handleEquipmentQuotation(response) {
                // Construct the table HTML for equipment details
                    var equipmentTableHtml = `
                        <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                            <thead>
                                <tr>
                                    <th style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">Equipment Name</th>
                                    <th style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">Quantity</th>
                                    <th style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">Unit Price</th>
                                    <th style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">No of Days</th>
                                    <th style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">Total Amount</th>
                                    <th style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">Notes</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;

                    response.equipment_details.forEach(function (detail) {
                        equipmentTableHtml += `
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">${detail.equipment_name}</td>
                                <td style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">${detail.quantity}</td>
                                <td style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">RS. ${detail.rental_price}</td>
                                <td style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">${response.total_days}</td>
                                <td style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">RS. ${detail.total_rental_price}</td>
                                <td style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;"> ${response.job.notes}</td>
                            </tr>
                        `;
                    });

                    equipmentTableHtml += `
                            </tbody>
                        </table>
                    `;


                                var printContent = `
                        <!DOCTYPE html>
                        <html lang="en">
                        <head>
                            <meta charset="UTF-8">
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
                            <style>
                                .box {
                                    background-color: #fff;
                                    padding: 20px;
                                    margin: 10px auto;
                                    max-width: 700px;
                                    min-height: 100%;
                                }
                                .container {
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: center;
                                    padding: 0px;
                                }
                                .left {
                                    width: 150px;
                                    text-align: left;
                                }
                                .right {
                                    width: 150px;
                                    text-align: right;
                                    padding-top: 5px;
                                    margin-top: -60px;
                                }
                                .left p {
                                    margin-bottom: 4px;
                                }
                                .left h3 {
                                    margin-bottom: -10px;
                                }
                                .left h5 {
                                    margin-top: 5px;
                                }
                                .logo {
                                    width: 100px;
                                    align-item: center;
                                }
                                .job-details {
                                    display: flex;
                                    border-top: 1px solid #000000;
                                    padding-top: -10px;
                                    justify-content: space-between;
                                    height: auto;
                                }
                                .job_left {
                                    display: flex;
                                    flex-direction: column;
                                }
                                .job_left p {
                                    margin-bottom: -5px;
                                }
                                .job_left p b {
                                    display: inline-block;
                                    width: 120px;
                                }
                                .job_left p span {
                                    display: inline-block;
                                    margin-left: -22px;
                                }
                                .job_right {
                                    display: flex;
                                    flex-direction: column;
                                    width: 150px; /* Maintain the width */
                                    word-wrap: break-word; /* Ensures that long text wraps to the next line */
                                }

                                .job_right p {
                                    margin-bottom: -5px;
                                    display: flex;
                                    flex-wrap: wrap;
                                }

                                .job_right p b {
                                    flex: 0 0 90px; /* Fixed width for the label */
                                    display: inline-block;
                                }

                                .job_right p span {
                                    flex: 1; /* Allows the span to take up remaining space */
                                    display: inline-block;
                                    word-wrap: break-word; /* Ensures text inside <span> wraps properly */
                                }
                                .job-details-description {
                                    margin-top: 15px;
                                    border-top: 1px solid #000000;
                                    display: flex;
                                    flex-direction: column;
                                    align-item: left;
                                    margin-bottom: 20px;
                                }
                                .job-details-description h4 {
                                    text-align: left;
                                }
                                .job-details-description h2 {
                                    text-align: left;
                                    margin-top: -15px;
                                }
                                .job_equipment_container {
                                    display: flex;
                                    justify-content: space-between;
                                    margin-top: -10px;
                                }
                                .job_left_equipment {
                                    width: 45%;
                                }
                                .job_right_equipment {
                                    width: 45%;
                                    float: right;
                                    text-align: right;
                                }
                                .color-amount{
                                    background-color: #b5c3c9;
                                }
                                @page {
                                    size: A4;
                                    margin: 0;
                                }
                                body {
                                    margin: 0;
                                    font-size: 10pt;
                                    background-color: white;
                                }
                                @media only screen and (max-width: 300px) {
                                    .container {
                                        flex-direction: column;
                                        align-items: center;
                                    }
                                    .job-details {
                                        width: 100%;
                                    }
                                    .job_left,
                                    .job_right {
                                        width: 100%;
                                        text-align: center;
                                    }
                                }
                            </style>
                        </head>
                        <body>
                            <div class="box">
                                <div class="container">
                                    <div class="left">
                                        <h3><u>Registered Address:</u></h3>
                                        <h3 style="font-size: 14px;">${response.company.company_name}</h3>
                                        <p>${response.company.address}</p>
                                        <p><a href="mailto:${response.company.email}">${response.company.email}</a></p>
                                        <h5>GST No: ${response.company.gst_no}</h5>
                                    </div>
                                    <div class="logo">
                                        <img id="logoImage" src="${response.company.company_logo}" class="logo" alt="Logo" />
                                    </div>
                                    <div class="right">
                                        <h3><u>Warehouse Address:</u></h3>
                                        <p>Parle Colony, Andheri, East, 567889</p>
                                        <p>9768476574</p>
                                        <p>${response.job.job_reference_no}</p>
                                    </div>
                                </div>
                                <div>
                                    <h3 style="text-align: center; font-size: 30px; margin-top: -35px;">${response.job.status}</h3>
                                </div>
                                <div class="job-details">
                                    <div class="job_left" style="width: 300px;">
                                        <p><b>Job Title:</b><span> ${response.job.title}</span></p>
                                        <p><b>Job Reference:</b><span> ${response.job.job_reference_no}</span></p>
                                        <p><b>Job Date Out:</b><span> ${response.job.event_date ? response.job.event_date : '-'}</span></p>
                                        <p><b>Job Date Back:</b><span> ${response.job.dismantle_date ? response.job.dismantle_date : '-'}</span></p>
                                        <p><b>Sales Person:</b><span> ${response.job.contact_person_name}</span></p>
                                    </div>
                                    <div class="job_right" style="width: 200px;">
                                        <p><b>Venue:</b><span> ${response.job.venue_address}</span></p>
                                        <p><b>Client Name:</b><span> ${response.job.client_name}</span></p>
                                        <p><b>Client Contact:</b><span> ${response.job.contact_person_number}</span></p>
                                    </div>
                                </div>
                                <div class="job-details-description">

                                    <div style="background-color: #c5d9e1; padding: 10px; margin: 0;">
                                <h2 style="margin: 0;">Audio Equipment</h2>
                            </div>
                                    ${equipmentTableHtml}
                                </div>
                                <div style="height:30px;" class="color-amount">
                                    <p style="text-align: right; color: black; margin-right: 5px;"><b>Total for AUDIO EQUIPMENT RS. ${response.total_rental_sum}</b></p>
                                </div>
                                <div>
                                    <p style="text-align: right;">Total RS. ${response.total_rental_sum}</p>
                                </div>
                                <div>
                                    <p style="text-align: right;">After Discount RS. ${response.total_after_discount}</p>
                                </div>
                                <div>
                                    <p style="text-align: right;">Total Amount with 18% GST RS. ${response.total_with_gst}</p>
                                </div>

                            </div>
                        </body>
                        </html>
                    `;

                                // Open the print window
                                var printWindow = window.open('', '_blank');
                                printWindow.document.open();
                                printWindow.document.write(printContent);
                                printWindow.document.close();

                                // Wait for the content to load and then print
                                printWindow.onload = function () {
                                    printWindow.focus();
                                    printWindow.print();
                                    printWindow.close();
                                };
            }

            function handleEquipmentQuotationPdf(response) {
                var equipmentTableHtml = `
        <table style="width: 100%; border-collapse: collapse; margin-top: 5px;">
            <thead>
                <tr>
                    <th style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">Equipment Name</th>
                    <th style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">Quantity</th>
                    <th style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">Unit Price</th>
                    <th style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">No of Days</th>
                    <th style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">Total Amount</th>
                    <th style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">Notes</th>
                </tr>
            </thead>
            <tbody>
    `;

    response.equipment_details.forEach(function (detail) {
        equipmentTableHtml += `
            <tr>
                <td style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">${detail.equipment_name}</td>
                <td style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">${detail.quantity}</td>
                <td style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">${detail.rental_price}</td>
                <td style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">${response.total_days}</td>
                <td style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">${detail.total_rental_price}</td>
                <td style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">${response.job.notes}</td>
            </tr>
        `;
    });

    equipmentTableHtml += `
            </tbody>
        </table>
    `;

                var printContent = `
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>
            .box {
                background-color: #fff;
                padding: 10px;
                margin: 5px auto;
                max-width: 90%;
                min-height: 100%;
            }
            .container {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .left {
                width: 150px;
                text-align: left;
                padding-top: 20px;
                color: black;
                height: auto;

            }
            .left h4 {
                margin-bottom: 2px;
            }
            .left p {
                margin-bottom: 0px;
            }
            .right {
                width: 150px;
                text-align: right;
                padding-top: 1px;
                color: black;
                height: auto;
            }
            .right h4 {
                margin-bottom: 2px;
            }
            .right p {
                margin-bottom: 2px;
            }
            .logo {
                width: 145px;
                align-item: center;
            }
            .job-details {
                display: flex;
                border-top: 5px solid #000000;
                margin-top: -2px;
                padding-top: -10px;
                justify-content: space-between;
                height: auto;
                color: black;
            }
            .equipment-details {
                display: flex;
                border-top: 8px solid #d1e0d3;
                margin-top: 20px;
                padding-top: 10px;
                justify-content: space-between;
                height: auto;
                font-size: 12px;
            }

            .equipment_left {
                display: flex;
                flex-direction: column;
                margin-top: -2px;
                justify-content: space-between;
                color: #1a1d20;

            }

            .equipment_left p {
                margin-bottom: 0px; /* Adjusted margin for better spacing */
            }

            .equipment_left p b {
                display: inline-block;
                width: 110px; /* Fixed width for labels to align values */
            }
            .equipment_left b{
            font-size: 12px;
            color: #0c0c0c;
            }

            .equipment_left p span {
                display: inline-block;
                margin-left: 5px; /* Space between label and value */
                text-align: left; /* Align values to the left */
            }
            .equipment_right {
                display: flex;
                flex-direction: column;
                margin-top: -2px;
                justify-content: space-between;
                color: #1a1d20;
            }

            .equipment_right p {
                margin-bottom: 0px; /* Adjusted margin for better spacing */
            }

            .equipment_right p b {
                display: inline-block;
                width: 110px; /* Fixed width for labels to align values */
            }

            .equipment_right p span {
                display: inline-block;
                margin-left: 5px; /* Space between label and value */
                text-align: left; /* Align values to the left */
            }
            .equipment_right b{
                font-size: 12px;
                color: #0c0c0c;
            }
            .job_left {
                display: flex;
                flex-direction: column;
            }
            .job_left p {
                margin-bottom: 0px;
                font-size: 11px;
            }
            .job_left p b {
                display: inline-block;
                width: 110px;
            }
            .job_left p span {
                display: inline-block;
                margin-left: -22px;
            }
            .job_right {
                display: flex;
                flex-direction: column;
                width: 150px; /* Maintain the width */
                word-wrap: break-word; /* Ensures that long text wraps to the next line */
            }
            .job_right p {
                font-size: 11px;
                margin-bottom: 0px;
                display: flex;
                flex-wrap: wrap;
            }
            .job_right p b {
                flex: 0 0 100px; /* Fixed width for the label */
                display: inline-block;
            }
            .job_right p span {
                flex: 1; /* Allows the span to take up remaining space */
                display: inline-block;
                word-wrap: break-word; /* Ensures text inside <span> wraps properly */
            }
            .job-details-description {
                margin-top: 30px;
                border-top: 1px solid #000000;
                display: flex;
                flex-direction: column;
                align-item: left;
                margin-bottom: 20px;
            }
            .job-details-description h4 {
                text-align: left;
                margin-top: 10px;
            }
            .job-details-description h2 {
                text-align: left;
                margin-top: -15px;
            }
            .job_equipment_container {
                display: flex;
                justify-content: space-between;
                margin-top: -10px;
                color: #0c0c0c;
            }
            .job_left_equipment {
                width: 45%;
            }
            .job_right_equipment {
                width: 45%;
                float: right;
                text-align: right;
            }
            .color-amount {
                background-color: #bfcddb;
            }
            .job-container {
                display: flex;
                justify-content: space-between; /* Ensures that h4 and p are spaced apart */
                align-items: center; /* Centers items vertically within the div */
            }
            .job-details-left {
                margin-top: 10px; /* Removes default margin */
            }
            .job-details-center {
                margin: 0; /* Removes default margin */
                text-align: center; /* Centers text inside the paragraph */
                flex: 1; /* Allows the paragraph to take up remaining space */
            }
            #default-text {
                font-size: 20px;
                font-weight: bolder;
                margin-top: auto;
                text-decoration: underline;
            }
            #color {
                background-color: #bfcddb;
                color: #0b0c0f;
                border-bottom: 1px solid #000000;
                font-style: italic;
            }
            .customer-details {
                display: inline-block;
                vertical-align: top;
                max-width: 150px;
            }
            .company-address {
                margin-top: 5px;
                word-wrap: break-word;
            }
            @page {
                size: A4;
                margin: 0;
            }
            body {
                margin: 0px;
                font-size: 10pt;
                background-color: #FFFFFF;
                padding: 0px;
                font-family: "Times New Roman";
            }
            @media only screen and (max-width: 500px) {
                .container {
                    flex-direction: column;
                    align-items: center;
                }
                .job-details {
                    width: 100%;
                }
                .job_left,
                .job_right {
                    width: 100%;
                    text-align: center;
                }

            }
        </style>
    </head>
    <body>
        <div class="box">
            <div class="container">
                <div class="left">
                    <h4 style="font-size: 12px; font-weight: bolder; margin-bottom: 2px;"><u>Registered Address:</u></h4>
                    <h3 style="font-size: 12px;">${response.company.company_name}</h3>
                    <p style="font-size: 11px;">${response.company.address}</p>
                    <p style="font-size: 11px; color: #56c5f5;"><a href="mailto:${response.company.email}">${response.company.email}</a></p>
                    <p style="font-size: 11px;">GST No: ${response.company.gst_no}</p>
                </div>
                <div class="logo">
                    <img id="logoImage" src="${response.company.company_logo}" class="logo" alt="Logo" />
                </div>
                <div class="right">
                    <h4 style="font-size: 12px; font-weight: bolder; margin-bottom: 2px;"><u>Warehouse Address:</u></h4>
                    <p style="font-size: 11px;">Parle Colony, Andheri, East, 567889</p>
                    <p style="font-size: 11px;">9768476574</p>
                    <p style="font-size: 11px;">${response.job.job_reference_no}</p>
                </div>
            </div>
            <div>
                <h3 style="text-align: center; font-size: 30px; margin-top: -35px;">${response.job.status}</h3>
            </div>
            <div class="job-details">
                <div class="job_left" style="width: 400px;">
                    <p><b>Job Title:</b><span> ${response.job.title}</span></p>
                    <p><b>Job Ref:</b><span> ${response.job.job_reference_no}</span></p>
                    <p><b>Job Date Out:</b><span> ${response.job.event_date ? response.job.event_date : '-'}</span></p>
                    <p><b>Job Date Back:</b><span> ${response.job.dismantle_date ? response.job.dismantle_date : '-'}</span></p>
                    <p><b>Sales Person:</b><span> ${response.job.contact_person_name}</span></p>
                </div>
                <div class="job_right" style="width: 200px;">
                    <p><b>Venue:</b><span> ${response.job.venue_address}</span></p>
                    <p><b>Client Name:</b><span> ${response.job.client_name}</span></p>
                    <p><b>Client Contact:</b><span> ${response.job.contact_person_number}</span></p>
                </div>
            </div>
            <div class="job-details-description">
            <div class="job-container">
                </div>
                <h2 id="color" style="font-size: 14px; font-weight: bolder">AUDIO EQUIPMENT</h2>
                        ${equipmentTableHtml}
            </div>
            <div style="height:30px;" class="color-amount">
                                    <p style="background-color: #c5d9e1; text-align: right; color: black; margin-right: 5px;"><b>Total for AUDIO EQUIPMENT RS. ${response.total_rental_sum}</b></p>
                                </div>
                                <div>
                                    <p style="text-align: right;">Total RS. ${response.total_rental_sum}</p>
                                </div>
                                <div>
                                    <p style="text-align: right;">After Discount RS. ${response.total_after_discount}</p>
                                </div>
                                <div>
                                    <p style="text-align: right;">Total Amount with 18% GST RS. ${response.total_with_gst}</p>
                                </div>
        </div>
    </body>
    </html>
    `;
                // Convert the HTML to a PDF and download it
    var opt = {
        margin:       0,
        filename:     'Equipment Based Quotation.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
    };

    html2pdf().from(printContent).set(opt).save();
            }

            function handleTotalQuotation(response) {
                // Construct the table HTML for equipment details
    var equipmentTableHtml = `
        <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
            <thead>
                <tr>
                    <th style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">Equipment Name</th>
                    <th style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">Quantity</th>
                    <th style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">Unit Price</th>
                    <th style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">Notes</th>
                </tr>
            </thead>
            <tbody>
    `;

    response.equipment_details.forEach(function (detail) {
        equipmentTableHtml += `
            <tr>
                <td style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">${detail.equipment_name}</td>
                <td style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">${detail.quantity}</td>
                <td style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">RS. ${detail.rental_price}</td>
                <td style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;"> ${response.job.notes}</td>
            </tr>
        `;
    });

    equipmentTableHtml += `
            </tbody>
        </table>
    `;


                var printContent = `
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <style>
                .box {
                    background-color: #fff;
                    padding: 20px;
                    margin: 10px auto;
                    max-width: 700px;
                    min-height: 100%;
                }
                .container {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 0px;
                }
                .left {
                    width: 150px;
                    text-align: left;
                }
                .right {
                    width: 150px;
                    text-align: right;
                    padding-top: 5px;
                    margin-top: -60px;
                }
                .left p {
                    margin-bottom: 4px;
                }
                .left h3 {
                    margin-bottom: -10px;
                }
                .left h5 {
                    margin-top: 5px;
                }
                .logo {
                    width: 100px;
                    align-item: center;
                }
                .job-details {
                    display: flex;
                    border-top: 1px solid #000000;
                    padding-top: -10px;
                    justify-content: space-between;
                    height: auto;
                }
                .job_left {
                    display: flex;
                    flex-direction: column;
                }
                .job_left p {
                    margin-bottom: -5px;
                }
                .job_left p b {
                    display: inline-block;
                    width: 120px;
                }
                .job_left p span {
                    display: inline-block;
                    margin-left: -22px;
                }
.job_right {
    display: flex;
    flex-direction: column;
    width: 150px; /* Maintain the width */
    word-wrap: break-word; /* Ensures that long text wraps to the next line */
}

.job_right p {
    margin-bottom: -5px;
    display: flex;
    flex-wrap: wrap;
}

.job_right p b {
    flex: 0 0 90px; /* Fixed width for the label */
    display: inline-block;
}

.job_right p span {
    flex: 1; /* Allows the span to take up remaining space */
    display: inline-block;
    word-wrap: break-word; /* Ensures text inside <span> wraps properly */
}



                .job-details-description {
                    margin-top: 15px;
                    border-top: 1px solid #000000;
                    display: flex;
                    flex-direction: column;
                    align-item: left;
                    margin-bottom: 20px;
                }
                .job-details-description h4 {
                    text-align: left;
                }
                .job-details-description h2 {
                    text-align: left;
                    margin-top: -15px;
                }
                .job_equipment_container {
                    display: flex;
                    justify-content: space-between;
                    margin-top: -10px;
                }
                .job_left_equipment {
                    width: 45%;
                }
                .job_right_equipment {
                    width: 45%;
                    float: right;
                    text-align: right;
                }
                .color-amount{
                    background-color: #b5c3c9;
                }
                @page {
                    size: A4;
                    margin: 0;
                }
                body {
                    margin: 0;
                    font-size: 10pt;
                    background-color: white;
                }
                @media only screen and (max-width: 300px) {
                    .container {
                        flex-direction: column;
                        align-items: center;
                    }
                    .job-details {
                        width: 100%;
                    }
                    .job_left,
                    .job_right {
                        width: 100%;
                        text-align: center;
                    }
                }
            </style>
        </head>
        <body>
            <div class="box">
                <div class="container">
                    <div class="left">
                        <h3><u>Registered Address:</u></h3>
                        <h3 style="font-size: 14px;">${response.company.company_name}</h3>
                        <p>${response.company.address}</p>
                        <p><a href="mailto:${response.company.email}">${response.company.email}</a></p>
                        <h5>GST No: ${response.company.gst_no}</h5>
                    </div>
                    <div class="logo">
                        <img id="logoImage" src="${response.company.company_logo}" class="logo" alt="Logo" />
                    </div>
                    <div class="right">
                        <h3><u>Warehouse Address:</u></h3>
                        <p>Parle Colony, Andheri, East, 567889</p>
                        <p>9768476574</p>
                        <p>${response.job.job_reference_no}</p>
                    </div>
                </div>
                <div>
                    <h3 style="text-align: center; font-size: 30px; margin-top: -35px;">${response.job.status}</h3>
                </div>
                <div class="job-details">
                    <div class="job_left" style="width: 300px;">
                        <p><b>Job Title:</b><span> ${response.job.title}</span></p>
                        <p><b>Job Reference:</b><span> ${response.job.job_reference_no}</span></p>
                        <p><b>Job Date Out:</b><span> ${response.job.event_date ? response.job.event_date : '-'}</span></p>
                        <p><b>Job Date Back:</b><span> ${response.job.dismantle_date ? response.job.dismantle_date : '-'}</span></p>
                        <p><b>No of Days:</b><span> ${response.job.total_days}</span></p>
                        <p><b>Sales Person:</b><span> ${response.job.contact_person_name}</span></p>
                    </div>
                    <div class="job_right" style="width: 200px;">
                        <p><b>Venue:</b><span> ${response.job.venue_address}</span></p>
                        <p><b>Customer:</b><span> ${response.job.client_name}</span></p>
                        <p><b>Client Contact:</b><span> ${response.job.contact_person_number}</span></p>
                    </div>
                </div>
                <div class="job-details-description">

                    <div style="background-color: #c5d9e1; padding: 10px; margin: 0;">
                <h2 style="margin: 0;">Audio Equipment</h2>
            </div>
                    ${equipmentTableHtml}
                </div>
                <div style="height:30px;" class="color-amount">
                    <p style="text-align: right; color: black;"><b>Total for AUDIO EQUIPMENT RS. ${response.job.total_amount}</b></p>
                </div>
                <div>
                    <p style="text-align: right;">Total RS. ${response.job.amount_row}</p>
                </div>
                <div>
                    <p style="text-align: right;">After Discount RS. ${response.job.amount_after_discount}</p>
                </div>
                <div>
                    <p style="text-align: right;">Total Amount with 18% GST RS. ${response.job.total_amount}</p>
                </div>
            </div>
        </body>
        </html>
    `;

                // Open the print window
                var printWindow = window.open('', '_blank');
                printWindow.document.open();
                printWindow.document.write(printContent);
                printWindow.document.close();

                // Wait for the content to load and then print
                printWindow.onload = function () {
                    printWindow.focus();
                    printWindow.print();
                    printWindow.close();
                };
            }

            function handleTotalQuotationPdf(response) {
                var equipmentTableHtml = `
        <table style="width: 100%; border-collapse: collapse; margin-top: 5px;">
            <thead>
                <tr>
                    <th style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">Equipment Name</th>
                    <th style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">Quantity</th>
                    <th style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">Unit Price</th>
                    <th style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">Notes</th>
                </tr>
            </thead>
            <tbody>
    `;

    response.equipment_details.forEach(function (detail) {
        equipmentTableHtml += `
            <tr>
                <td style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">${detail.equipment_name}</td>
                <td style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">${detail.quantity}</td>
                <td style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">${detail.rental_price}</td>
                <td style="border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">${response.job.notes}</td>
            </tr>
        `;
    });

    equipmentTableHtml += `
            </tbody>
        </table>
    `;

                var printContent = `
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>
            .box {
                background-color: #fff;
                padding: 10px;
                margin: 5px auto;
                max-width: 90%;
                min-height: 100%;
            }
            .container {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .left {
                width: 150px;
                text-align: left;
                padding-top: 20px;
                color: black;
                height: auto;

            }
            .left h4 {
                margin-bottom: 2px;
            }
            .left p {
                margin-bottom: 0px;
            }
            .right {
                width: 150px;
                text-align: right;
                padding-top: 1px;
                color: black;
                height: auto;
            }
            .right h4 {
                margin-bottom: 2px;
            }
            .right p {
                margin-bottom: 2px;
            }
            .logo {
                width: 145px;
                align-item: center;
            }
            .job-details {
                display: flex;
                border-top: 5px solid #000000;
                margin-top: -2px;
                padding-top: -10px;
                justify-content: space-between;
                height: auto;
                color: black;
            }
            .equipment-details {
                display: flex;
                border-top: 8px solid #d1e0d3;
                margin-top: 20px;
                padding-top: 10px;
                justify-content: space-between;
                height: auto;
                font-size: 12px;
            }

            .equipment_left {
                display: flex;
                flex-direction: column;
                margin-top: -2px;
                justify-content: space-between;
                color: #1a1d20;

            }

            .equipment_left p {
                margin-bottom: 0px; /* Adjusted margin for better spacing */
            }

            .equipment_left p b {
                display: inline-block;
                width: 110px; /* Fixed width for labels to align values */
            }
            .equipment_left b{
            font-size: 12px;
            color: #0c0c0c;
            }

            .equipment_left p span {
                display: inline-block;
                margin-left: 5px; /* Space between label and value */
                text-align: left; /* Align values to the left */
            }
            .equipment_right {
                display: flex;
                flex-direction: column;
                margin-top: -2px;
                justify-content: space-between;
                color: #1a1d20;
            }

            .equipment_right p {
                margin-bottom: 0px; /* Adjusted margin for better spacing */
            }

            .equipment_right p b {
                display: inline-block;
                width: 110px; /* Fixed width for labels to align values */
            }

            .equipment_right p span {
                display: inline-block;
                margin-left: 5px; /* Space between label and value */
                text-align: left; /* Align values to the left */
            }
            .equipment_right b{
                font-size: 12px;
                color: #0c0c0c;
            }
            .job_left {
                display: flex;
                flex-direction: column;
            }
            .job_left p {
                margin-bottom: 0px;
                font-size: 11px;
            }
            .job_left p b {
                display: inline-block;
                width: 110px;
            }
            .job_left p span {
                display: inline-block;
                margin-left: -22px;
            }
            .job_right {
                display: flex;
                flex-direction: column;
                width: 150px; /* Maintain the width */
                word-wrap: break-word; /* Ensures that long text wraps to the next line */
            }
            .job_right p {
                font-size: 11px;
                margin-bottom: 0px;
                display: flex;
                flex-wrap: wrap;
            }
            .job_right p b {
                flex: 0 0 100px; /* Fixed width for the label */
                display: inline-block;
            }
            .job_right p span {
                flex: 1; /* Allows the span to take up remaining space */
                display: inline-block;
                word-wrap: break-word; /* Ensures text inside <span> wraps properly */
            }
            .job-details-description {
                margin-top: 30px;
                border-top: 1px solid #000000;
                display: flex;
                flex-direction: column;
                align-item: left;
                margin-bottom: 20px;
            }
            .job-details-description h4 {
                text-align: left;
                margin-top: 10px;
            }
            .job-details-description h2 {
                text-align: left;
                margin-top: -15px;
            }
            .job_equipment_container {
                display: flex;
                justify-content: space-between;
                margin-top: -10px;
                color: #0c0c0c;
            }
            .job_left_equipment {
                width: 45%;
            }
            .job_right_equipment {
                width: 45%;
                float: right;
                text-align: right;
            }
            .color-amount {
                background-color: #bfcddb;
            }
            .job-container {
                display: flex;
                justify-content: space-between; /* Ensures that h4 and p are spaced apart */
                align-items: center; /* Centers items vertically within the div */
            }
            .job-details-left {
                margin-top: 10px; /* Removes default margin */
            }
            .job-details-center {
                margin: 0; /* Removes default margin */
                text-align: center; /* Centers text inside the paragraph */
                flex: 1; /* Allows the paragraph to take up remaining space */
            }
            #default-text {
                font-size: 20px;
                font-weight: bolder;
                margin-top: auto;
                text-decoration: underline;
            }
            #color {
                background-color: #bfcddb;
                color: #0b0c0f;
                border-bottom: 1px solid #000000;
                font-style: italic;
            }
            .customer-details {
                display: inline-block;
                vertical-align: top;
                max-width: 150px;
            }
            .company-address {
                margin-top: 5px;
                word-wrap: break-word;
            }
            @page {
                size: A4;
                margin: 0;
            }
            body {
                margin: 0px;
                font-size: 10pt;
                background-color: #FFFFFF;
                padding: 0px;
                font-family: "Times New Roman";
            }
            @media only screen and (max-width: 500px) {
                .container {
                    flex-direction: column;
                    align-items: center;
                }
                .job-details {
                    width: 100%;
                }
                .job_left,
                .job_right {
                    width: 100%;
                    text-align: center;
                }

            }
        </style>
    </head>
    <body>
        <div class="box">
            <div class="container">
                <div class="left">
                    <h4 style="font-size: 12px; font-weight: bolder; margin-bottom: 2px;"><u>Registered Address:</u></h4>
                    <h3 style="font-size: 12px;">${response.company.company_name}</h3>
                    <p style="font-size: 11px;">${response.company.address}</p>
                    <p style="font-size: 11px; color: #56c5f5;"><a href="mailto:${response.company.email}">${response.company.email}</a></p>
                    <p style="font-size: 11px;">GST No: ${response.company.gst_no}</p>
                </div>
                <div class="logo">
                    <img id="logoImage" src="${response.company.company_logo}" class="logo" alt="Logo" />
                </div>
                <div class="right">
                    <h4 style="font-size: 12px; font-weight: bolder; margin-bottom: 2px;"><u>Warehouse Address:</u></h4>
                    <p style="font-size: 11px;">Parle Colony, Andheri, East, 567889</p>
                    <p style="font-size: 11px;">9768476574</p>
                    <p style="font-size: 11px;">${response.job.job_reference_no}</p>
                </div>
            </div>
            <div>
                <h3 style="text-align: center; font-size: 30px; margin-top: -35px;">${response.job.status}</h3>
            </div>
            <div class="job-details">
                <div class="job_left" style="width: 400px;">
                    <p><b>Job Title:</b><span> ${response.job.title}</span></p>
                    <p><b>Job Ref:</b><span> ${response.job.job_reference_no}</span></p>
                    <p><b>Job Date Out:</b><span> ${response.job.event_date ? response.job.event_date : '-'}</span></p>
                    <p><b>Job Date Back:</b><span> ${response.job.dismantle_date ? response.job.dismantle_date : '-'}</span></p>
                    <p><b>No of Days:</b><span> ${response.job.total_days}</span></p>
                    <p><b>Sales Person:</b><span> ${response.job.contact_person_name}</span></p>
                </div>
                <div class="job_right" style="width: 200px;">
                    <p><b>Venue:</b><span> ${response.job.venue_address}</span></p>
                    <p><b>Customer:</b><span> ${response.job.client_name}</span></p>
                    <p><b>Client Contact:</b><span> ${response.job.contact_person_number}</span></p>
                </div>
            </div>

            <div class="job-details-description">
                <div class="job-container">
                    </div>
                    <h2 id="color" style="font-size: 14px; font-weight: bolder">AUDIO EQUIPMENT</h2>
                        ${equipmentTableHtml}
                </div>
                <div style="height:30px;" class="color-amount">
                    <p style="text-align: right; color: black;"><b>Total for AUDIO EQUIPMENT RS. ${response.job.total_amount}</b></p>
                </div>
                <div>
                    <p style="text-align: right;">Total RS. ${response.job.amount_row}</p>
                </div>
                <div>
                    <p style="text-align: right;">After Discount RS. ${response.job.amount_after_discount}</p>
                </div>
                <div>
                    <p style="text-align: right;">Total Amount with 18% GST RS. ${response.job.total_amount}</p>
                </div>
            </div>
    </body>
    </html>
    `;
                // Convert the HTML to a PDF and download it
    var opt = {
        margin:       0,
        filename:     'Total Quotation.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
    };

    html2pdf().from(printContent).set(opt).save();
            }


function handleDeliveryChallan(response) {
                var equipmentTableHtml = `
        <table style="width: 100%; border-collapse: collapse; margin-top: 5px;">
            <thead>
                <tr>
                    <th style="width: 40%; border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">Equipment Name</th>
                    <th style="width: 20%; border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">Quantity</th>
                    <th style="width: 40%; border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">Notes</th>
                </tr>
            </thead>
            <tbody>
    `;

    response.equipment_details.forEach(function (detail) {
        equipmentTableHtml += `
            <tr>
                <td style="width: 40%; border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">${detail.equipment_name}</td>
                <td style="width: 20%; border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">${detail.quantity}</td>
                <td style="width: 40%; border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left;">${response.job.notes}</td>
            </tr>
        `;
    });

    equipmentTableHtml += `
            </tbody>
        </table>
    `;

                var printContent = `
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>
            .box {
                background-color: #fff;
                padding: 20px;
                margin: 10px auto;
                max-width: 700px;
                min-height: 100%;
            }
            .container {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0px;
                font-style: italic;
                font-weight: bolder;
            }
            .left {
                width: 150px;
                text-align: left;
            }
            .right {
                width: 150px;
                text-align: right;
                padding-top: 5px;
                margin-top: -60px;
            }
            .right p {
                margin-bottom: -8px;
            }
            .right h3 {
                margin-bottom: -10px;
            }
            .right h4 {
                margin-bottom: -10px;
            }
            .left h4 {
                margin-bottom: -10px;
            }
            .left p {
                margin-bottom: 4px;
            }
            .left h3 {
                margin-bottom: -10px;
            }
            .left h5 {
                margin-top: 5px;
            }
            .logo {
                width: 145px;
                align-item: center;
            }
            .job-details {
                display: flex;
                border-top: 5px solid #000000;
                margin-top: -25px;
                padding-top: -10px;
                justify-content: space-between;
                height: auto;
            }
            .equipment-details {
                display: flex;
                border-top: 10px solid #d1e0d3;
                margin-top: 20px;
                padding-top: 10px;
                justify-content: space-between;
                height: auto;
            }

            .equipment_left {
                display: flex;
                flex-direction: column;
                margin-top: -15px;
            }

            .equipment_left p {
                margin-bottom: -8px; /* Adjusted margin for better spacing */
            }

            .equipment_left p b {
                display: inline-block;
                width: 100px; /* Fixed width for labels to align values */
            }

            .equipment_left p span {
                display: inline-block;
                margin-left: 5px; /* Space between label and value */
                text-align: left; /* Align values to the left */
            }
            .equipment_right {
                display: flex;
                flex-direction: column;
                margin-top: -15px;
            }

            .equipment_right p {
                margin-bottom: -8px; /* Adjusted margin for better spacing */
            }

            .equipment_right p b {
                display: inline-block;
                width: 100px; /* Fixed width for labels to align values */
            }

            .equipment_right p span {
                display: inline-block;
                margin-left: 5px; /* Space between label and value */
                text-align: left; /* Align values to the left */
            }
            .job_left {
                display: flex;
                flex-direction: column;
            }
            .job_left p {
                margin-bottom: -12px;
            }
            .job_left p b {
                display: inline-block;
                width: 110px;
            }
            .job_left p span {
                display: inline-block;
                margin-left: -22px;
            }
            .job_right {
    display: flex;
    flex-direction: column;
    width: 150px; /* Maintain the width */
    word-wrap: break-word; /* Ensures that long text wraps to the next line */
}

.job_right p {
    margin-bottom: -5px;
    display: flex;
    flex-wrap: wrap;
}

.job_right p b {
    flex: 0 0 100px; /* Fixed width for the label */
    display: inline-block;
}

.job_right p span {
    flex: 1; /* Allows the span to take up remaining space */
    display: inline-block;
    word-wrap: break-word; /* Ensures text inside <span> wraps properly */
}
            .job-details-description {
                margin-top: 30px;
                border-top: 1px solid #000000;
                display: flex;
                flex-direction: column;
                align-item: left;
                margin-bottom: 20px;
            }
            .job-details-description h4 {
                text-align: left;
                margin-top: 10px;
            }
            .job-details-description h2 {
                text-align: left;
                margin-top: -15px;
            }
            .job_equipment_container {
                display: flex;
                justify-content: space-between;
                margin-top: -10px;
            }
            .job_left_equipment {
                width: 45%;
            }
            .job_right_equipment {
                width: 45%;
                float: right;
                text-align: right;
            }
            .color-amount {
                background-color: #00aced;
            }
            .job-container {
                display: flex;
                justify-content: space-between; /* Ensures that h4 and p are spaced apart */
                align-items: center; /* Centers items vertically within the div */
            }
            .job-details-left {
                margin-top: 10px; /* Removes default margin */
            }
            .job-details-center {
                margin: 0; /* Removes default margin */
                text-align: center; /* Centers text inside the paragraph */
                flex: 1; /* Allows the paragraph to take up remaining space */
            }
            #default-text {
                font-size: 20px;
                font-weight: bolder;
                margin-top: auto;
                text-decoration: underline;
            }
            #color {
                background-color: #bfcddb;
                color: #0b0c0f;
                border-bottom: 1px solid #000000;
                font-style: italic;
            }
            .customer-details {
                display: inline-block;
                vertical-align: top;
                max-width: 150px;
            }
            .company-address {
                margin-top: 5px;
                word-wrap: break-word;
            }
            @page {
                size: A4;
                margin: 0;
            }
            body {
                margin: 0px;
                font-size: 10pt;
                background-color: #FFFFFF;
                padding: 0px;
            }
            @media only screen and (max-width: 500px) {
                .container {
                    flex-direction: column;
                    align-items: center;
                }
                .job-details {
                    width: 100%;
                }
                .job_left,
                .job_right {
                    width: 100%;
                    text-align: center;
                }

            }
        </style>
    </head>
    <body>
        <div class="box">
            <div class="container">
                <div class="left">
                    <h4><u><i>Registered Address:</i></u></h4>
                    <h3 style="font-size: 12px;">${response.company.company_name}</h3>
                    <p>${response.company.address}</p>
                    <p style="margin-top:-4px;"><a href="mailto:${response.company.email}">${response.company.email}</a></p>
                    <h5>GST No: ${response.company.gst_no}</h5>
                </div>
                <div class="logo">
                    <img id="logoImage" src="${response.company.company_logo}" class="logo" alt="Logo" />
                </div>
                <div class="right">
                    <h4><u>Warehouse Address:</u></h4>
                    <p>Parle Colony, Andheri, East, 567889</p>
                    <p>9768476574</p>
                    <p>${response.job.job_reference_no}</p>
                </div>
            </div>
            <div>
                <h3 style="text-align: center; font-size: 30px; margin-top: -35px;">${response.job.status}</h3>
            </div>
            <div class="job-details">
                <div class="job_left" style="width: 400px;">
                    <p><b>Job Title:</b><span> ${response.job.title}</span></p>
                    <p><b>Job Ref:</b><span> ${response.job.job_reference_no}</span></p>
                    <p><b>Client:</b><span class="customer-details"> ${response.job.client_name}<br>${response.job.address}<br>
                    ${response.job.state}<br>${response.job.post_code}<br>${response.job.country}</span></p>
                </div>
                <div class="job_right" style="width: 200px;">
                    <p><b>Venue:</b><span> ${response.job.venue_address}</span></p>
                    <p><b>Sound Engineer:</b><span> ${response.job.contact_person_name}</span></p>
                    <p><b>Client Contact:</b><span> ${response.job.contact_person_number}</span></p>
                </div>
            </div>
            <div class="equipment-details">
                <div class="equipment_left" style="width: 700px;">
                    <p><b>Equipment Title:</b><span> ${response.job.title}</span>:<span>${response.job.job_reference_no}</span></p>
                    <p><b>Equipment Ref:</b><span> ${response.job.job_reference_no}</span></p>
                    <p><b>Event Start Date:</b><span> ${response.job.event_date ? response.job.event_date : '-'}</span></p>
                    <p><b>Event End Date:</b><span> ${response.job.dismantle_date ? response.job.dismantle_date : '-'}</span></p>
                </div>
                <div class="equipment_right" style="width: 300px;">
                    <p><b>Show Start Date:</b><span> ${response.job.event_date ? response.job.event_date : '-'}</span></p>
                    <p><b>Setup Date:</b><span> ${response.job.setup_date}</span></p>
                    <p><b>Show End Date:</b><span> ${response.job.dismantle_date ? response.job.dismantle_date : '-'}</span></p>
                    <p><b>Pack Up Date:</b><span> ${response.job.dismantle_date ? response.job.dismantle_date : '-'}</span></p>
                </div>
            </div>
            <div class="job-details-description">
            <div class="job-container">

                </div>
                <h2 id="color">AUDIO EQUIPMENT</h2>

                        ${equipmentTableHtml}

            </div>
        </div>
    </body>
    </html>
    `;
                // Open the print window
                var printWindow = window.open('', '_blank');
                printWindow.document.open();
                printWindow.document.write(printContent);
                printWindow.document.close();

                // Wait for the content to load and then print
                printWindow.onload = function () {
                    printWindow.focus();
                    printWindow.print();
                    printWindow.close();
                };
            }

            function handleDeliveryChallanPdf(response) {
                var equipmentTableHtml = `
        <table style="width: 100%; border-collapse: collapse; margin-top: 5px;">
            <thead>
                <tr>
                    <th style="width: 40%; border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">Equipment Name</th>
                    <th style="width: 20%; border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">Quantity</th>
                    <th style="width: 40%; border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">Notes</th>
                </tr>
            </thead>
            <tbody>
    `;

    response.equipment_details.forEach(function (detail) {
        equipmentTableHtml += `
            <tr>
                <td style="width: 40%; border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">${detail.equipment_name}</td>
                <td style="width: 20%; border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">${detail.quantity}</td>
                <td style="width: 40%; border: 1px solid #ddd; padding: 4px 4px 4px 10px; text-align: left; color: #1a1d20; font-size: 12px;">${response.job.notes}</td>
            </tr>
        `;
    });

    equipmentTableHtml += `
            </tbody>
        </table>
    `;

                var printContent = `
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>
            .box {
                background-color: #fff;
                padding: 10px;
                margin: 5px auto;
                max-width: 90%;
                min-height: 100%;
            }
            .container {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .left {
                width: 150px;
                text-align: left;
                padding-top: 20px;
                color: black;
                height: auto;

            }
            .left h4 {
                margin-bottom: 2px;
            }
            .left p {
                margin-bottom: 0px;
            }
            .right {
                width: 150px;
                text-align: right;
                padding-top: 1px;
                color: black;
                height: auto;
            }
            .right h4 {
                margin-bottom: 2px;
            }
            .right p {
                margin-bottom: 2px;
            }
            .logo {
                width: 145px;
                align-item: center;
            }
            .job-details {
                display: flex;
                border-top: 5px solid #000000;
                margin-top: -2px;
                padding-top: -10px;
                justify-content: space-between;
                height: auto;
                color: black;
            }
            .equipment-details {
                display: flex;
                border-top: 8px solid #d1e0d3;
                margin-top: 20px;
                padding-top: 10px;
                justify-content: space-between;
                height: auto;
                font-size: 12px;
            }

            .equipment_left {
                display: flex;
                flex-direction: column;
                margin-top: -2px;
                justify-content: space-between;
                color: #1a1d20;

            }

            .equipment_left p {
                margin-bottom: 0px; /* Adjusted margin for better spacing */
            }

            .equipment_left p b {
                display: inline-block;
                width: 110px; /* Fixed width for labels to align values */
            }
            .equipment_left b{
            font-size: 12px;
            color: #0c0c0c;
            }

            .equipment_left p span {
                display: inline-block;
                margin-left: 5px; /* Space between label and value */
                text-align: left; /* Align values to the left */
            }
            .equipment_right {
                display: flex;
                flex-direction: column;
                margin-top: -2px;
                justify-content: space-between;
                color: #1a1d20;
            }

            .equipment_right p {
                margin-bottom: 0px; /* Adjusted margin for better spacing */
            }

            .equipment_right p b {
                display: inline-block;
                width: 110px; /* Fixed width for labels to align values */
            }

            .equipment_right p span {
                display: inline-block;
                margin-left: 5px; /* Space between label and value */
                text-align: left; /* Align values to the left */
            }
            .equipment_right b{
                font-size: 12px;
                color: #0c0c0c;
            }
            .job_left {
                display: flex;
                flex-direction: column;
            }
            .job_left p {
                margin-bottom: 0px;
                font-size: 11px;
            }
            .job_left p b {
                display: inline-block;
                width: 110px;
            }
            .job_left p span {
                display: inline-block;
                margin-left: -22px;
            }
            .job_right {
                display: flex;
                flex-direction: column;
                width: 150px; /* Maintain the width */
                word-wrap: break-word; /* Ensures that long text wraps to the next line */
            }
            .job_right p {
                font-size: 11px;
                margin-bottom: 0px;
                display: flex;
                flex-wrap: wrap;
            }
            .job_right p b {
                flex: 0 0 100px; /* Fixed width for the label */
                display: inline-block;
            }
            .job_right p span {
                flex: 1; /* Allows the span to take up remaining space */
                display: inline-block;
                word-wrap: break-word; /* Ensures text inside <span> wraps properly */
            }
            .job-details-description {
                margin-top: 30px;
                border-top: 1px solid #000000;
                display: flex;
                flex-direction: column;
                align-item: left;
                margin-bottom: 20px;
            }
            .job-details-description h4 {
                text-align: left;
                margin-top: 10px;
            }
            .job-details-description h2 {
                text-align: left;
                margin-top: -15px;
            }
            .job_equipment_container {
                display: flex;
                justify-content: space-between;
                margin-top: -10px;
                color: #0c0c0c;
            }
            .job_left_equipment {
                width: 45%;
            }
            .job_right_equipment {
                width: 45%;
                float: right;
                text-align: right;
            }
            .color-amount {
                background-color: #00aced;
            }
            .job-container {
                display: flex;
                justify-content: space-between; /* Ensures that h4 and p are spaced apart */
                align-items: center; /* Centers items vertically within the div */
            }
            .job-details-left {
                margin-top: 10px; /* Removes default margin */
            }
            .job-details-center {
                margin: 0; /* Removes default margin */
                text-align: center; /* Centers text inside the paragraph */
                flex: 1; /* Allows the paragraph to take up remaining space */
            }
            #default-text {
                font-size: 20px;
                font-weight: bolder;
                margin-top: auto;
                text-decoration: underline;
            }
            #color {
                background-color: #bfcddb;
                color: #0b0c0f;
                border-bottom: 1px solid #000000;
                font-style: italic;
            }
            .customer-details {
                display: inline-block;
                vertical-align: top;
                max-width: 150px;
            }
            .company-address {
                margin-top: 5px;
                word-wrap: break-word;
            }
            @page {
                size: A4;
                margin: 0;
            }
            body {
                margin: 0px;
                font-size: 10pt;
                background-color: #FFFFFF;
                padding: 0px;
                font-family: "Times New Roman";
            }
            @media only screen and (max-width: 500px) {
                .container {
                    flex-direction: column;
                    align-items: center;
                }
                .job-details {
                    width: 100%;
                }
                .job_left,
                .job_right {
                    width: 100%;
                    text-align: center;
                }

            }
        </style>
    </head>
    <body>
        <div class="box">
            <div class="container">
                <div class="left">
                    <h4 style="font-size: 12px; font-weight: bolder; margin-bottom: 2px;"><u>Registered Address:</u></h4>
                    <h3 style="font-size: 12px;">${response.company.company_name}</h3>
                    <p style="font-size: 11px;">${response.company.address}</p>
                    <p style="font-size: 11px; color: #56c5f5;"><a href="mailto:${response.company.email}">${response.company.email}</a></p>
                    <p style="font-size: 11px;">GST No: ${response.company.gst_no}</p>
                </div>
                <div class="logo">
                    <img id="logoImage" src="${response.company.company_logo}" class="logo" alt="Logo" />
                </div>
                <div class="right">
                    <h4 style="font-size: 12px; font-weight: bolder; margin-bottom: 2px;"><u>Warehouse Address:</u></h4>
                    <p style="font-size: 11px;">Parle Colony, Andheri, East, 567889</p>
                    <p style="font-size: 11px;">9768476574</p>
                    <p style="font-size: 11px;">${response.job.job_reference_no}</p>
                </div>
            </div>
            <div>
                <h3 style="text-align: center; font-size: 30px; margin-top: -35px;">${response.job.status}</h3>
            </div>
            <div class="job-details">
                <div class="job_left" style="width: 400px;">
                    <p><b>Job Title:</b><span> ${response.job.title}</span></p>
                    <p><b>Job Ref:</b><span> ${response.job.job_reference_no}</span></p>
                    <p><b>Client:</b><span class="customer-details"> ${response.job.client_name}<br>${response.job.address}<br>
                    ${response.job.state}<br>${response.job.post_code}<br>${response.job.country}</span></p>
                </div>
                <div class="job_right" style="width: 200px;">
                    <p><b>Venue:</b><span> ${response.job.venue_address}</span></p>
                    <p><b>Sound Engineer:</b><span> ${response.job.contact_person_name}</span></p>
                    <p><b>Client Contact:</b><span> ${response.job.contact_person_number}</span></p>
                </div>
            </div>
            <div class="equipment-details">
                <div class="equipment_left" style="width: 60%;">
                    <p><b>Equipment Title:</b><span> ${response.job.title}</span>:<span>${response.job.job_reference_no}</span></p>
                    <p><b>Equipment Ref:</b><span> ${response.job.job_reference_no}</span></p>
                    <p><b>Event Start Date:</b><span> ${response.job.event_date ? response.job.event_date : '-'}</span></p>
                    <p><b>Event End Date:</b><span> ${response.job.dismantle_date ? response.job.dismantle_date : '-'}</span></p>
                </div>
                <div class="equipment_right" style="width: 32%;">
                    <p><b>Show Start Date:</b><span> ${response.job.event_date ? response.job.event_date : '-'}</span></p>
                    <p><b>Setup Date:</b><span> ${response.job.setup_date}</span></p>
                    <p><b>Show End Date:</b><span> ${response.job.dismantle_date ? response.job.dismantle_date : '-'}</span></p>
                    <p><b>Pack Up Date:</b><span> ${response.job.dismantle_date ? response.job.dismantle_date : '-'}</span></p>
                </div>
            </div>
            <div class="job-details-description">
            <div class="job-container">

                </div>
                <h2 id="color" style="font-size: 14px; font-weight: bolder">AUDIO EQUIPMENT</h2>

                        ${equipmentTableHtml}

            </div>
        </div>
    </body>
    </html>
    `;
                // Convert the HTML to a PDF and download it
    var opt = {
        margin:       0,
        filename:     'Delivery Challan.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
    };

    html2pdf().from(printContent).set(opt).save();
            }

});
    </script>


    <body>
    <!--*******************
        Preloader start
    ********************-->
    <div id="preloader">
        <div class="lds-ripple">
            <div></div>
            <div></div>
        </div>
    </div>
    <!--*******************
        Preloader end
    ********************-->

    <!--**********************************
        Main wrapper start
    ***********************************-->
    <div id="main-wrapper">
        <!--**********************************
            Nav header start
        ***********************************-->
        {% include 'product_tracking/navheader.html' %}
        <!--**********************************
            Nav header end
        ***********************************-->

        <!--**********************************
                    Header start
        ***********************************-->
        {% include 'product_tracking/header.html' %}
        <!--**********************************
                    Header end
        ***********************************-->

        <!--**********************************
            Sidebar start
        ***********************************-->
        {% include 'product_tracking/sidebar.html' %}
        <!--**********************************
            Sidebar end
        ***********************************-->

        <!--**********************************
            Content body start
        ***********************************-->

        <div class="content-body">
             <div class="page-titles d-flex justify-content-between align-items-center">
                    <!-- Left-aligned Order Book title -->
                    <div>
                        <h5 class="bc-title">Order book</h5>
                    </div>

                    <!-- Right-aligned Share as PDF button -->

                    <div class="col-auto ms-auto" style="padding-left: 600px; position: relative;">
                        <button id="shareAsPdf" class="btn btn-primary btn-sm"> Share As Pdf</button>
                        <div id="dropdown-container" class="dropdown-menu" style="display: none; position: absolute;">
                            <button class="dropdown-item btn btn-secondary btn-sm" id="equipmentQuotation" onclick="handleQuotation('Equipment')"
                                ><i class="bi bi-file-earmark-pdf-fill" style="color: red"></i> Equipment Quotation
                            </button>
                            <button class="dropdown-item btn btn-secondary btn-sm" id="totalQuotation" onclick="handleQuotation('Total')"
                                ><i class="bi bi-file-earmark-pdf-fill" style="color: red"></i> Total Quotation
                            </button>
                        </div>
                        <div id="delivery-options-container" style="display:none;">
                        <button id="printOption" class="dropdown-item" style="text-align: center;"><i class="bi bi-printer-fill"></i> Print</button>
                        <button id="pdfOption" class="dropdown-item" style="text-align: center;"><i class="bi bi-file-fill"></i> PDF</button>

</div>

                    </div>
                </div>

            <div class="form-container">
                <div class="step-buttons">
                    <button class="step-btn" onclick="showStep(1)" id="generalDetailsBtn">General Details</button>
                    <button class="step-btn" onclick="validateStep(1, 2)" id="addEquipmentBtn">Add Equipment</button>
                    <button class="step-btn" onclick="validateStep(1, 3)" id="addSubVendorBtn">Add Sub Vendor</button>
                    <button class="step-btn" onclick="validateStep(1, 4)" id="crewAllocationBtn">Crew Allocation
                    </button>
                    <button class="step-btn" onclick="validateStep(1, 5)" id="transportationBtn">Transportation</button>
                </div>

                <form id="multi-step-form">
                    {% csrf_token %}

                    <div class="form-step" id="step-1">
                        <div class="row">
                            <div class="col-xl-6 mb-3">
                                <label for="titleInput" class="form-label">Title</label>
                                <input type="text" class="form-control" id="titleInput" name="title"
                                       required>
                            </div>
                            <div class="col-xl-6 mb-3">
                                <div class="dropdown">
                                    <label for="clientNameDropdown" class="form-label">Client Name</label>
                                    <input type="text" class="form-control dropdown-toggle"
                                           id="clientNameDropdown"
                                           data-bs-toggle="dropdown" aria-expanded="false"
                                           placeholder="Select Client Name" autocomplete="off"
                                           name="client_name">
                                    <ul class="dropdown-menu" aria-labelledby="clientNameDropdown">
                                        <!-- Dynamic options will be appended here -->
                                    </ul>
                                </div>
                            </div>
                            <div class="col-xl-3 mb-3">
                                <div class="dropdown">
                                    <label for="clientContactName" class="form-label">Contact Person Name</label>
                                    <select class="form-control" id="clientContactName" name="contact_person_name">

                                    </select>
                                </div>
                            </div>
                            <div class="col-xl-3 mb-3">
                                <div class="dropdown">
                                    <label for="clientContactNumber" class="form-label">Contact Person Number</label>
                                    <input type="text" class="form-control" id="clientContactNumber"
                                           placeholder="Contact Person Number"
                                           name="contact_person_number" readonly>
                                </div>
                            </div>
                            <div class="col-xl-3 mb-3">
                                <label class="form-label">Status</label>
                                <select class="default-select form-control" id="statusType"
                                        name="status">
                                    <option value="Quotation">Quotation</option>
                                    <option value="Perfoma">Perfoma</option>
                                    <option value="Prepsheet">Prepsheet</option>
                                    <option value="Delivery Challan">Delivery Challan</option>
                                </select>
                            </div>
                            <div class="col-xl-3 mb-3" id="quotation-fields">
                                <label for="crewType" class="form-label">Crew Quantity</label>
                                <input type="text" class="form-control" id="crewQuantity"
                                           placeholder="Enter Quantity"
                                           name="crew_quantity" style="margin-top: -2px;">
                            </div>
                            <div class="col-xl-6 mb-3">
                                <div class="dropdown">
                                    <label for="venueAddressDropdown" class="form-label">Venue Name</label>
                                    <input type="text" class="form-control dropdown-toggle" id="venueAddressDropdown"
                                           data-bs-toggle="dropdown" aria-expanded="false"
                                           placeholder="Select Venue Name"
                                           autocomplete="off" name="venue_address">
                                    <ul class="dropdown-menu" aria-labelledby="venueAddressDropdown" id="dropdown-item">
                                        <!-- Dynamic options will be appended here -->
                                    </ul>
                                </div>
                            </div>
                            <div class="col-xl-6 mb-3">
                                <label for="venueAddressInput" class="form-label">Venue Address</label>
                                <input type="text" class="form-control" id="venueAddressInput"
                                       placeholder="Venue Address"
                                       name="venue_address" readonly>
                            </div>

                            <div class="row">
                                <div class="col-xl-3 mb-3 custom-width">
                                    <label for="preDate" class="form-label">Setup Date</label>
                                    <input type="date" class="form-control" id="prepDate"
                                           name="setup_date" required>
                                </div>
                                <div class="col-xl-2 mb-3 custom-width">
                                    <label for="outDate" class="form-label">Rehearsal Date</label>
                                    <input type="date" class="form-control" id="outDate"
                                           name="rehearsal_date" required>
                                </div>
                                <div class="col-xl-2 mb-3 custom-width">
                                    <label for="showStart" class="form-label">Event Date</label>
                                    <input type="date" class="form-control" id="showStart"
                                           name="start_date" required>
                                </div>
                                <div class="col-xl-2 mb-3 custom-width">
                                    <label for="showEnd" class="form-label">Dismantle Date</label>
                                    <input type="date" class="form-control" id="showEnd" name="end_date"
                                           required>
                                </div>
                                <div class="col-xl-2 mb-3 custom-width">
                                    <label for="number_of_days" class="form-label">Number of
                                        Days</label>
                                    <input type="number" class="form-control" id="number_of_days" name="total_days">
                                </div>
                                <div class="col-xl-3 mb-3" id="prepsheet-fields"
                                    style="display: none; width: 176px; margin: 0px; padding: 0px;">
                                    <label class="form-label">Handler</label>
                                    <select class="default-select form-control" id="employeeName"
                                            name="employee_name" multiple="multiple">
                                        <option value="" data-display="Select">Select</option>
                                    </select>
                                </div>

                            </div>
                            <div class="row" id="quotation-fields1">
                                <div class="col-xl-3 mb-3">
                                    <label for="total_amount" class="form-label">Amount</label>
                                    <input type="number" class="form-control" id="total_amount"
                                           name="amount_row">
                                </div>
                                <div class="col-xl-3 mb-3">
                                    <label for="discount" class="form-label">Discount(%)</label>
                                    <input type="number" class="form-control" id="discount"
                                           name="discount">
                                </div>
                                <div class="col-xl-3 mb-3">
                                    <label for="discounted_amount" class="form-label">Amount After
                                        Discount</label>
                                    <input type="text" class="form-control" id="discounted_amount"
                                           name="discounted_amount">
                                </div>
                                <div class="col-xl-3 mb-3">
                                    <label for="total_amount_cal" class="form-label">Total Amount
                                        (18% GST)</label>
                                    <input type="number" class="form-control" id="total_amount_cal"
                                           name="total_amount">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-step" id="step-2">
                        <!-- First Section -->
                        <div class="row">
                            <div class="col-md-4">
                                <div class="left-equipment-container">
                                    <div class="quantity-container">
                                        <!-- Content that was dynamically inserted into the accordion -->
                                    </div>
                                </div>
                            </div>

                            <!-- Second Section -->
                            <div class="col-md-8">
                                <div class="right-equipment-container">

                                    <!-- Content for Equipment Search -->
                                    <div class="row">
                                        <!-- Left Container: Equipment Search and Quantity Input -->
                                        <div class="search-container">
                                            <div class="input-container">
                                                <input type="text" id="searchCategory" class="form-control"
                                                       placeholder="Search for equipment...">
                                                <div id="equipmentDropdown" class="dropdown-menu">
                                                    <!-- Dropdown content will be inserted here -->
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Right Container: Table -->
                                        <div class="equipment-table-container" style="margin-top: 6px;">
                                            <table id="selectedEquipmentTable" class="table custom-table">
                                                <thead class="thead-dark">
                                                <tr>
                                                    <th style="text-align: left;">Equipment Name</th>
                                                    <th>Quantity</th>
                                                </tr>
                                                </thead>
                                                <tbody style="align-items: center;">
                                                <!-- Rows will be dynamically added here -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-step" id="step-3">
                        <h4>Add Sub Vendor</h4>
                        <div id="table-container">
                            <table id="sub-vendor-table" class="table">
                                <thead>
                                <tr>
                                    <th>Vendor Name</th>
                                    <th>Equipment Name</th>
                                    <th>Quantity</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                <!-- Rows will be dynamically added here -->
                                </tbody>
                            </table>
                            <button id="add-sub-vendor-row-btn" class="btn btn-primary" style="margin-top: 9px;">Add
                            </button>
                        </div>
                    </div>

                    <div class="form-step" id="step-4">
                        <div class="d-flex justify-content-between align-items-center">
                            <h4>Crew Allocation</h4>
                            <input type="text" class="form-control" id="searchCrew" placeholder="Search...."
                                   style="width: 200px;margin-bottom: 7px;">
                        </div>
                        <div class="crew-container">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="crew-left-content">
                                    <div class="crew-row d-flex">
                                        <div class="col-xl-2 mb-3" style="margin-right: 14px; width: 26%;">
                                            <label for="crewType" class="form-label">Crew Type</label>
                                            <select class="default-select form-control" id="crewType" name="crew_type">
                                                <option value="A1">A1</option>
                                                <option value="A2">A2</option>
                                                <option value="A3">A3</option>
                                            </select>
                                        </div>
                                         <div class="col-xl-6 mb-3">
                            <div class="dropdown">
                                <label for="employeeNameDropdown" class="form-label">Client Name</label>
                                <input type="text" class="form-control dropdown-toggle"
                                    id="employeeNameDropdown"
                                    data-bs-toggle="dropdown" aria-expanded="false"
                                    placeholder="Select Client Name" autocomplete="off"
                                    name="employee_name">
                                <ul class="employee-dropdown-menu" aria-labelledby="employeeNameDropdown" id="employee-dropdown-item">
                                    <!-- Dynamic options will be appended here -->
                                </ul>
                            </div>
                        </div>

                                    </div>
                                </div>
                                <div class="crew-right-content">
                                    <div class="table-responsive table-card">
                                        <table class="table primary-table-bordered" id="employee-table">
                                            <thead class="thead-primary">
                                                <tr>

                                                    <th>Crew Type</th>
                                                    <th>Employee</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody id="crew-allocation-table-body">
                                                <!-- Rows will be dynamically added here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>

                    <div class="form-step" id="step-5">
    <h4>Transportation Allocation</h4>
    <div class="mb-3">
        <div class="d-flex">
            <div class="form-check me-3">
                <input class="form-check-input" type="radio" name="transportation_type" id="onVehicle" value="on_vehicle">
                <label class="form-check-label" for="onVehicle">Own Vehicle</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="transportation_type" id="outsideVehicle" value="outside_vehicle">
                <label class="form-check-label" for="outsideVehicle">Outside Vehicle</label>
            </div>
        </div>
    </div>
    <!-- Container for "Own Vehicle" details -->
    <div id="onVehicleFields" class="transportation-fields"></div>

    <!-- Container for "Outside Vehicle" details -->
    <div id="outsideVehicleFields" class="transportation-fields"></div>

    <div>
        <button class="btn btn-primary light ms-1" id="addTransportation">Add More</button>
    </div>
</div>




                </form>
            </div>
        </div>

        <!--**********************************
        Main wrapper end
        ***********************************-->
        {% include 'product_tracking/footer.html' %}
    </div>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet"/>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <meta name="csrf-token" content="{{ csrf_token }}">

    </body>
{% endblock %}